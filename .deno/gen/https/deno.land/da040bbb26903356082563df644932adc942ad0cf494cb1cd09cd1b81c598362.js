async function checkOffline(shard, highPriority) {
    if (!shard.isOpen()) {
        await new Promise((resolve) => {
            if (highPriority) {
                shard.offlineSendQueue.unshift(resolve);
            }
            else {
                shard.offlineSendQueue.push(resolve);
            }
        });
    }
}
export async function send(shard, message, highPriority) {
    await checkOffline(shard, highPriority);
    await shard.bucket.acquire(1, highPriority);
    await checkOffline(shard, highPriority);
    shard.socket?.send(JSON.stringify(message));
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VuZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInNlbmQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBRUEsS0FBSyxVQUFVLFlBQVksQ0FBQyxLQUFZLEVBQUUsWUFBcUI7SUFDN0QsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLEVBQUUsRUFBRTtRQUNuQixNQUFNLElBQUksT0FBTyxDQUFDLENBQUMsT0FBTyxFQUFFLEVBQUU7WUFDNUIsSUFBSSxZQUFZLEVBQUU7Z0JBRWhCLEtBQUssQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUM7YUFDekM7aUJBQU07Z0JBQ0wsS0FBSyxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQzthQUN0QztRQUNILENBQUMsQ0FBQyxDQUFDO0tBQ0o7QUFDSCxDQUFDO0FBRUQsTUFBTSxDQUFDLEtBQUssVUFBVSxJQUFJLENBQUMsS0FBWSxFQUFFLE9BQTJCLEVBQUUsWUFBcUI7SUFHekYsTUFBTSxZQUFZLENBQUMsS0FBSyxFQUFFLFlBQVksQ0FBQyxDQUFDO0lBRXhDLE1BQU0sS0FBSyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxFQUFFLFlBQVksQ0FBQyxDQUFDO0lBRzVDLE1BQU0sWUFBWSxDQUFDLEtBQUssRUFBRSxZQUFZLENBQUMsQ0FBQztJQUV4QyxLQUFLLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7QUFDOUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFNoYXJkLCBTaGFyZFNvY2tldFJlcXVlc3QgfSBmcm9tIFwiLi90eXBlcy50c1wiO1xuXG5hc3luYyBmdW5jdGlvbiBjaGVja09mZmxpbmUoc2hhcmQ6IFNoYXJkLCBoaWdoUHJpb3JpdHk6IGJvb2xlYW4pOiBQcm9taXNlPHZvaWQ+IHtcbiAgaWYgKCFzaGFyZC5pc09wZW4oKSkge1xuICAgIGF3YWl0IG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgICBpZiAoaGlnaFByaW9yaXR5KSB7XG4gICAgICAgIC8vIEhpZ2hlciBwcmlvcml0eSByZXF1ZXN0cyBnZXQgYWRkZWQgYXQgdGhlIGJlZ2lubmluZyBvZiB0aGUgYXJyYXkuXG4gICAgICAgIHNoYXJkLm9mZmxpbmVTZW5kUXVldWUudW5zaGlmdChyZXNvbHZlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHNoYXJkLm9mZmxpbmVTZW5kUXVldWUucHVzaChyZXNvbHZlKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2VuZChzaGFyZDogU2hhcmQsIG1lc3NhZ2U6IFNoYXJkU29ja2V0UmVxdWVzdCwgaGlnaFByaW9yaXR5OiBib29sZWFuKTogUHJvbWlzZTx2b2lkPiB7XG4gIC8vIEJlZm9yZSBhY3F1aXJpbmcgYSB0b2tlbiBmcm9tIHRoZSBidWNrZXQsIGNoZWNrIHdoZXRoZXIgdGhlIHNoYXJkIGlzIGN1cnJlbnRseSBvZmZsaW5lIG9yIG5vdC5cbiAgLy8gRWxzZSBidWNrZXQgYW5kIHRva2VuIHdhaXQgdGltZSBqdXN0IGdldCB3YXN0ZWQuXG4gIGF3YWl0IGNoZWNrT2ZmbGluZShzaGFyZCwgaGlnaFByaW9yaXR5KTtcblxuICBhd2FpdCBzaGFyZC5idWNrZXQuYWNxdWlyZSgxLCBoaWdoUHJpb3JpdHkpO1xuXG4gIC8vIEl0J3MgcG9zc2libGUsIHRoYXQgdGhlIHNoYXJkIHdlbnQgb2ZmbGluZSBhZnRlciBhIHRva2VuIGhhcyBiZWVuIGFjcXVpcmVkIGZyb20gdGhlIGJ1Y2tldC5cbiAgYXdhaXQgY2hlY2tPZmZsaW5lKHNoYXJkLCBoaWdoUHJpb3JpdHkpO1xuXG4gIHNoYXJkLnNvY2tldD8uc2VuZChKU09OLnN0cmluZ2lmeShtZXNzYWdlKSk7XG59XG4iXX0=