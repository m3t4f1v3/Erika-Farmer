import { identify } from "./identify.ts";
import { handleMessage } from "./handleMessage.ts";
import { DEFAULT_HEARTBEAT_INTERVAL, GATEWAY_RATE_LIMIT_RESET_INTERVAL, MAX_GATEWAY_REQUESTS_PER_INTERVAL, ShardState } from "./types.ts";
import { startHeartbeating } from "./startHeartbeating.ts";
import { stopHeartbeating } from "./stopHeartbeating.ts";
import { resume } from "./resume.ts";
import { createLeakyBucket } from "../../util/bucket.ts";
import { calculateSafeRequests } from "./calculateSafeRequests.ts";
import { send } from "./send.ts";
import { handleClose } from "./handleClose.ts";
import { connect } from "./connect.ts";
import { close } from "./close.ts";
import { shutdown } from "./shutdown.ts";
import { isOpen } from "./isOpen.ts";
import { API_VERSION } from "../../util/constants.ts";
// TODO: debug
// TODO: function overwrite
// TODO: improve shard event resolving
/** */ export function createShard(options) {
    // This is done for performance reasons
    const calculateSafeRequestsOverwritten = options.calculateSafeRequests ?? calculateSafeRequests;
    const closeOverwritten = options.close ?? close;
    const connectOverwritten = options.connect ?? connect;
    const identifyOverwritten = options.identify ?? identify;
    const sendOverwritten = options.send ?? send;
    const shutdownOverwritten = options.shutdown ?? shutdown;
    const resumeOverwritten = options.resume ?? resume;
    const handleCloseOverwritten = options.handleClose ?? handleClose;
    const handleMessageOverwritten = options.handleMessage ?? handleMessage;
    const isOpenOverwritten = options.isOpen ?? isOpen;
    const startHeartbeatingOverwritten = options.startHeartbeating ?? startHeartbeating;
    const stopHeartbeatingOverwritten = options.stopHeartbeating ?? stopHeartbeating;
    return {
        // ----------
        // PROPERTIES
        // ----------
        /** The gateway configuration which is used to connect to Discord. */ gatewayConfig: {
            compress: options.gatewayConfig.compress ?? false,
            intents: options.gatewayConfig.intents ?? 0,
            properties: {
                $os: options.gatewayConfig?.properties?.$os ?? Deno.build.os,
                $browser: options.gatewayConfig?.properties?.$browser ?? "Discordeno",
                $device: options.gatewayConfig?.properties?.$device ?? "Discordeno"
            },
            token: options.gatewayConfig.token,
            url: options.gatewayConfig.url ?? "wss://gateway.discord.gg",
            version: options.gatewayConfig.version ?? API_VERSION
        },
        /** This contains all the heartbeat information */ heart: {
            acknowledged: false,
            interval: DEFAULT_HEARTBEAT_INTERVAL
        },
        /** Id of the shard. */ id: options.id,
        /** The maximum of requests which can be send to discord per rate limit tick.
     * Typically this value should not be changed.
     */ maxRequestsPerRateLimitTick: MAX_GATEWAY_REQUESTS_PER_INTERVAL,
        /** The previous payload sequence number. */ previousSequenceNumber: options.previousSequenceNumber || null,
        /** In which interval (in milliseconds) the gateway resets it's rate limit. */ rateLimitResetInterval: GATEWAY_RATE_LIMIT_RESET_INTERVAL,
        /** Current session id of the shard if present. */ sessionId: undefined,
        /** This contains the WebSocket connection to Discord, if currently connected. */ socket: undefined,
        /** Current internal state of the shard. */ state: ShardState.Offline,
        /** The total amount of shards which are used to communicate with Discord. */ totalShards: options.totalShards,
        // ----------
        // METHODS
        // ----------
        /** The shard related event handlers. */ events: options.events ?? {},
        /** Calculate the amount of requests which can safely be made per rate limit interval,
     * before the gateway gets disconnected due to an exceeded rate limit.
     */ calculateSafeRequests: function() {
            return calculateSafeRequestsOverwritten(this);
        },
        /** Close the socket connection to discord if present. */ close: function(code, reason) {
            return closeOverwritten(this, code, reason);
        },
        /** Connect the shard with the gateway and start heartbeating.
     * This will not identify the shard to the gateway.
     */ connect: async function() {
            return await connectOverwritten(this);
        },
        /** Identify the shard to the gateway.
     * If not connected, this will also connect the shard to the gateway.
     */ identify: async function() {
            return await identifyOverwritten(this);
        },
        /** Check whether the connection to Discord is currently open. */ isOpen: function() {
            return isOpenOverwritten(this);
        },
        /** Function which can be overwritten in order to get the shards presence. */ // This function allows to be async, in case the devs create the presence based on eg. database values.
        // Passing the shard's id there to make it easier for the dev to use this function.
        makePresence: options.makePresence,
        /** Attempt to resume the previous shards session with the gateway. */ resume: async function() {
            return await resumeOverwritten(this);
        },
        /** Send a message to Discord.
     * @param {boolean} [highPriority=false] - Whether this message should be send asap.
     */ send: async function(message, highPriority = false) {
            return await sendOverwritten(this, message, highPriority);
        },
        /** Shutdown the shard.
     * Forcefully disconnect the shard from Discord.
     * The shard may not attempt to reconnect with Discord.
     */ shutdown: async function() {
            return await shutdownOverwritten(this);
        },
        /** @private Internal shard bucket.
     * Only access this if you know what you are doing.
     *
     * Bucket for handling shard request rate limits.
     */ bucket: createLeakyBucket({
            max: MAX_GATEWAY_REQUESTS_PER_INTERVAL,
            refillInterval: GATEWAY_RATE_LIMIT_RESET_INTERVAL,
            refillAmount: MAX_GATEWAY_REQUESTS_PER_INTERVAL
        }),
        /** @private Internal shard function.
     * Only use this function if you know what you are doing.
     *
     * Handle a gateway connection close.
     */ handleClose: async function(close1) {
            return await handleCloseOverwritten(this, close1);
        },
        /** @private Internal shard function.
     * Only use this function if you know what you are doing.
     *
     * Handle an incoming gateway message.
     */ handleMessage: async function(message) {
            return await handleMessageOverwritten(this, message);
        },
        /** This function communicates with the management process, in order to know whether its free to identify. */ requestIdentify: async function() {
            return await options.requestIdentify(this.id);
        },
        /** @private Internal state.
     * Only use this if you know what you are doing.
     *
     * Cache for pending gateway requests which should have been send while the gateway went offline.
     */ offlineSendQueue: [],
        /** @private Internal shard map.
     * Only use this map if you know what you are doing.
     *
     * This is used to resolve internal waiting states.
     * Mapped by SelectedEvents => ResolveFunction
     */ resolves: new Map(),
        /** @private Internal shard function.
     * Only use this function if you know what you are doing.
     *
     * Start sending heartbeat payloads to Discord in the provided interval.
     */ startHeartbeating: function(interval) {
            return startHeartbeatingOverwritten(this, interval);
        },
        /** @private Internal shard function.
     * Only use this function if you know what you are doing.
     *
     * Stop the heartbeating process with discord.
     */ stopHeartbeating: function() {
            return stopHeartbeatingOverwritten(this);
        }
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBpZGVudGlmeSB9IGZyb20gXCIuL2lkZW50aWZ5LnRzXCI7XG5pbXBvcnQgeyBoYW5kbGVNZXNzYWdlIH0gZnJvbSBcIi4vaGFuZGxlTWVzc2FnZS50c1wiO1xuaW1wb3J0IHtcbiAgREVGQVVMVF9IRUFSVEJFQVRfSU5URVJWQUwsXG4gIEdBVEVXQVlfUkFURV9MSU1JVF9SRVNFVF9JTlRFUlZBTCxcbiAgTUFYX0dBVEVXQVlfUkVRVUVTVFNfUEVSX0lOVEVSVkFMLFxuICBTaGFyZCxcbiAgU2hhcmRFdmVudHMsXG4gIFNoYXJkR2F0ZXdheUNvbmZpZyxcbiAgU2hhcmRIZWFydCxcbiAgU2hhcmRTb2NrZXRDbG9zZUNvZGVzLFxuICBTaGFyZFNvY2tldFJlcXVlc3QsXG4gIFNoYXJkU3RhdGUsXG59IGZyb20gXCIuL3R5cGVzLnRzXCI7XG5pbXBvcnQgeyBTdGF0dXNVcGRhdGUgfSBmcm9tIFwiLi4vLi4vaGVscGVycy9taXNjL2VkaXRTaGFyZFN0YXR1cy50c1wiO1xuaW1wb3J0IHsgc3RhcnRIZWFydGJlYXRpbmcgfSBmcm9tIFwiLi9zdGFydEhlYXJ0YmVhdGluZy50c1wiO1xuaW1wb3J0IHsgc3RvcEhlYXJ0YmVhdGluZyB9IGZyb20gXCIuL3N0b3BIZWFydGJlYXRpbmcudHNcIjtcbmltcG9ydCB7IHJlc3VtZSB9IGZyb20gXCIuL3Jlc3VtZS50c1wiO1xuaW1wb3J0IHsgY3JlYXRlTGVha3lCdWNrZXQsIExlYWt5QnVja2V0IH0gZnJvbSBcIi4uLy4uL3V0aWwvYnVja2V0LnRzXCI7XG5pbXBvcnQgeyBjYWxjdWxhdGVTYWZlUmVxdWVzdHMgfSBmcm9tIFwiLi9jYWxjdWxhdGVTYWZlUmVxdWVzdHMudHNcIjtcbmltcG9ydCB7IHNlbmQgfSBmcm9tIFwiLi9zZW5kLnRzXCI7XG5pbXBvcnQgeyBoYW5kbGVDbG9zZSB9IGZyb20gXCIuL2hhbmRsZUNsb3NlLnRzXCI7XG5pbXBvcnQgeyBjb25uZWN0IH0gZnJvbSBcIi4vY29ubmVjdC50c1wiO1xuaW1wb3J0IHsgY2xvc2UgfSBmcm9tIFwiLi9jbG9zZS50c1wiO1xuaW1wb3J0IHsgc2h1dGRvd24gfSBmcm9tIFwiLi9zaHV0ZG93bi50c1wiO1xuaW1wb3J0IHsgaXNPcGVuIH0gZnJvbSBcIi4vaXNPcGVuLnRzXCI7XG5pbXBvcnQgeyBEaXNjb3JkR2F0ZXdheVBheWxvYWQgfSBmcm9tIFwiLi4vLi4vdHlwZXMvZGlzY29yZC50c1wiO1xuaW1wb3J0IHsgR2F0ZXdheUludGVudHMsIFBpY2tQYXJ0aWFsIH0gZnJvbSBcIi4uLy4uL3R5cGVzL3NoYXJlZC50c1wiO1xuaW1wb3J0IHsgQVBJX1ZFUlNJT04gfSBmcm9tIFwiLi4vLi4vdXRpbC9jb25zdGFudHMudHNcIjtcblxuLy8gVE9ETzogZGVidWdcbi8vIFRPRE86IGZ1bmN0aW9uIG92ZXJ3cml0ZVxuLy8gVE9ETzogaW1wcm92ZSBzaGFyZCBldmVudCByZXNvbHZpbmdcblxuLyoqICovXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlU2hhcmQoXG4gIG9wdGlvbnM6IENyZWF0ZVNoYXJkLFxuKSB7XG4gIC8vIFRoaXMgaXMgZG9uZSBmb3IgcGVyZm9ybWFuY2UgcmVhc29uc1xuICBjb25zdCBjYWxjdWxhdGVTYWZlUmVxdWVzdHNPdmVyd3JpdHRlbiA9IG9wdGlvbnMuY2FsY3VsYXRlU2FmZVJlcXVlc3RzID8/IGNhbGN1bGF0ZVNhZmVSZXF1ZXN0cztcbiAgY29uc3QgY2xvc2VPdmVyd3JpdHRlbiA9IG9wdGlvbnMuY2xvc2UgPz8gY2xvc2U7XG4gIGNvbnN0IGNvbm5lY3RPdmVyd3JpdHRlbiA9IG9wdGlvbnMuY29ubmVjdCA/PyBjb25uZWN0O1xuICBjb25zdCBpZGVudGlmeU92ZXJ3cml0dGVuID0gb3B0aW9ucy5pZGVudGlmeSA/PyBpZGVudGlmeTtcbiAgY29uc3Qgc2VuZE92ZXJ3cml0dGVuID0gb3B0aW9ucy5zZW5kID8/IHNlbmQ7XG4gIGNvbnN0IHNodXRkb3duT3ZlcndyaXR0ZW4gPSBvcHRpb25zLnNodXRkb3duID8/IHNodXRkb3duO1xuICBjb25zdCByZXN1bWVPdmVyd3JpdHRlbiA9IG9wdGlvbnMucmVzdW1lID8/IHJlc3VtZTtcbiAgY29uc3QgaGFuZGxlQ2xvc2VPdmVyd3JpdHRlbiA9IG9wdGlvbnMuaGFuZGxlQ2xvc2UgPz8gaGFuZGxlQ2xvc2U7XG4gIGNvbnN0IGhhbmRsZU1lc3NhZ2VPdmVyd3JpdHRlbiA9IG9wdGlvbnMuaGFuZGxlTWVzc2FnZSA/PyBoYW5kbGVNZXNzYWdlO1xuICBjb25zdCBpc09wZW5PdmVyd3JpdHRlbiA9IG9wdGlvbnMuaXNPcGVuID8/IGlzT3BlbjtcbiAgY29uc3Qgc3RhcnRIZWFydGJlYXRpbmdPdmVyd3JpdHRlbiA9IG9wdGlvbnMuc3RhcnRIZWFydGJlYXRpbmcgPz8gc3RhcnRIZWFydGJlYXRpbmc7XG4gIGNvbnN0IHN0b3BIZWFydGJlYXRpbmdPdmVyd3JpdHRlbiA9IG9wdGlvbnMuc3RvcEhlYXJ0YmVhdGluZyA/PyBzdG9wSGVhcnRiZWF0aW5nO1xuXG4gIHJldHVybiB7XG4gICAgLy8gLS0tLS0tLS0tLVxuICAgIC8vIFBST1BFUlRJRVNcbiAgICAvLyAtLS0tLS0tLS0tXG5cbiAgICAvKiogVGhlIGdhdGV3YXkgY29uZmlndXJhdGlvbiB3aGljaCBpcyB1c2VkIHRvIGNvbm5lY3QgdG8gRGlzY29yZC4gKi9cbiAgICBnYXRld2F5Q29uZmlnOiB7XG4gICAgICBjb21wcmVzczogb3B0aW9ucy5nYXRld2F5Q29uZmlnLmNvbXByZXNzID8/IGZhbHNlLFxuICAgICAgaW50ZW50czogb3B0aW9ucy5nYXRld2F5Q29uZmlnLmludGVudHMgPz8gMCxcbiAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgJG9zOiBvcHRpb25zLmdhdGV3YXlDb25maWc/LnByb3BlcnRpZXM/LiRvcyA/PyBEZW5vLmJ1aWxkLm9zLFxuICAgICAgICAkYnJvd3Nlcjogb3B0aW9ucy5nYXRld2F5Q29uZmlnPy5wcm9wZXJ0aWVzPy4kYnJvd3NlciA/PyBcIkRpc2NvcmRlbm9cIixcbiAgICAgICAgJGRldmljZTogb3B0aW9ucy5nYXRld2F5Q29uZmlnPy5wcm9wZXJ0aWVzPy4kZGV2aWNlID8/IFwiRGlzY29yZGVub1wiLFxuICAgICAgfSxcbiAgICAgIHRva2VuOiBvcHRpb25zLmdhdGV3YXlDb25maWcudG9rZW4sXG4gICAgICB1cmw6IG9wdGlvbnMuZ2F0ZXdheUNvbmZpZy51cmwgPz8gXCJ3c3M6Ly9nYXRld2F5LmRpc2NvcmQuZ2dcIixcbiAgICAgIHZlcnNpb246IG9wdGlvbnMuZ2F0ZXdheUNvbmZpZy52ZXJzaW9uID8/IEFQSV9WRVJTSU9OLFxuICAgIH0gYXMgU2hhcmRHYXRld2F5Q29uZmlnLFxuICAgIC8qKiBUaGlzIGNvbnRhaW5zIGFsbCB0aGUgaGVhcnRiZWF0IGluZm9ybWF0aW9uICovXG4gICAgaGVhcnQ6IHtcbiAgICAgIGFja25vd2xlZGdlZDogZmFsc2UsXG4gICAgICBpbnRlcnZhbDogREVGQVVMVF9IRUFSVEJFQVRfSU5URVJWQUwsXG4gICAgfSBhcyBTaGFyZEhlYXJ0LFxuICAgIC8qKiBJZCBvZiB0aGUgc2hhcmQuICovXG4gICAgaWQ6IG9wdGlvbnMuaWQsXG4gICAgLyoqIFRoZSBtYXhpbXVtIG9mIHJlcXVlc3RzIHdoaWNoIGNhbiBiZSBzZW5kIHRvIGRpc2NvcmQgcGVyIHJhdGUgbGltaXQgdGljay5cbiAgICAgKiBUeXBpY2FsbHkgdGhpcyB2YWx1ZSBzaG91bGQgbm90IGJlIGNoYW5nZWQuXG4gICAgICovXG4gICAgbWF4UmVxdWVzdHNQZXJSYXRlTGltaXRUaWNrOiBNQVhfR0FURVdBWV9SRVFVRVNUU19QRVJfSU5URVJWQUwsXG4gICAgLyoqIFRoZSBwcmV2aW91cyBwYXlsb2FkIHNlcXVlbmNlIG51bWJlci4gKi9cbiAgICBwcmV2aW91c1NlcXVlbmNlTnVtYmVyOiBvcHRpb25zLnByZXZpb3VzU2VxdWVuY2VOdW1iZXIgfHwgbnVsbCxcbiAgICAvKiogSW4gd2hpY2ggaW50ZXJ2YWwgKGluIG1pbGxpc2Vjb25kcykgdGhlIGdhdGV3YXkgcmVzZXRzIGl0J3MgcmF0ZSBsaW1pdC4gKi9cbiAgICByYXRlTGltaXRSZXNldEludGVydmFsOiBHQVRFV0FZX1JBVEVfTElNSVRfUkVTRVRfSU5URVJWQUwsXG4gICAgLyoqIEN1cnJlbnQgc2Vzc2lvbiBpZCBvZiB0aGUgc2hhcmQgaWYgcHJlc2VudC4gKi9cbiAgICBzZXNzaW9uSWQ6IHVuZGVmaW5lZCBhcyBzdHJpbmcgfCB1bmRlZmluZWQsXG4gICAgLyoqIFRoaXMgY29udGFpbnMgdGhlIFdlYlNvY2tldCBjb25uZWN0aW9uIHRvIERpc2NvcmQsIGlmIGN1cnJlbnRseSBjb25uZWN0ZWQuICovXG4gICAgc29ja2V0OiB1bmRlZmluZWQgYXMgV2ViU29ja2V0IHwgdW5kZWZpbmVkLFxuICAgIC8qKiBDdXJyZW50IGludGVybmFsIHN0YXRlIG9mIHRoZSBzaGFyZC4gKi9cbiAgICBzdGF0ZTogU2hhcmRTdGF0ZS5PZmZsaW5lLFxuICAgIC8qKiBUaGUgdG90YWwgYW1vdW50IG9mIHNoYXJkcyB3aGljaCBhcmUgdXNlZCB0byBjb21tdW5pY2F0ZSB3aXRoIERpc2NvcmQuICovXG4gICAgdG90YWxTaGFyZHM6IG9wdGlvbnMudG90YWxTaGFyZHMsXG5cbiAgICAvLyAtLS0tLS0tLS0tXG4gICAgLy8gTUVUSE9EU1xuICAgIC8vIC0tLS0tLS0tLS1cblxuICAgIC8qKiBUaGUgc2hhcmQgcmVsYXRlZCBldmVudCBoYW5kbGVycy4gKi9cbiAgICBldmVudHM6IG9wdGlvbnMuZXZlbnRzID8/IHt9IGFzIFNoYXJkRXZlbnRzLFxuXG4gICAgLyoqIENhbGN1bGF0ZSB0aGUgYW1vdW50IG9mIHJlcXVlc3RzIHdoaWNoIGNhbiBzYWZlbHkgYmUgbWFkZSBwZXIgcmF0ZSBsaW1pdCBpbnRlcnZhbCxcbiAgICAgKiBiZWZvcmUgdGhlIGdhdGV3YXkgZ2V0cyBkaXNjb25uZWN0ZWQgZHVlIHRvIGFuIGV4Y2VlZGVkIHJhdGUgbGltaXQuXG4gICAgICovXG4gICAgY2FsY3VsYXRlU2FmZVJlcXVlc3RzOiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gY2FsY3VsYXRlU2FmZVJlcXVlc3RzT3ZlcndyaXR0ZW4odGhpcyk7XG4gICAgfSxcblxuICAgIC8qKiBDbG9zZSB0aGUgc29ja2V0IGNvbm5lY3Rpb24gdG8gZGlzY29yZCBpZiBwcmVzZW50LiAqL1xuICAgIGNsb3NlOiBmdW5jdGlvbiAoY29kZTogbnVtYmVyLCByZWFzb246IHN0cmluZykge1xuICAgICAgcmV0dXJuIGNsb3NlT3ZlcndyaXR0ZW4odGhpcywgY29kZSwgcmVhc29uKTtcbiAgICB9LFxuXG4gICAgLyoqIENvbm5lY3QgdGhlIHNoYXJkIHdpdGggdGhlIGdhdGV3YXkgYW5kIHN0YXJ0IGhlYXJ0YmVhdGluZy5cbiAgICAgKiBUaGlzIHdpbGwgbm90IGlkZW50aWZ5IHRoZSBzaGFyZCB0byB0aGUgZ2F0ZXdheS5cbiAgICAgKi9cbiAgICBjb25uZWN0OiBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gYXdhaXQgY29ubmVjdE92ZXJ3cml0dGVuKHRoaXMpO1xuICAgIH0sXG5cbiAgICAvKiogSWRlbnRpZnkgdGhlIHNoYXJkIHRvIHRoZSBnYXRld2F5LlxuICAgICAqIElmIG5vdCBjb25uZWN0ZWQsIHRoaXMgd2lsbCBhbHNvIGNvbm5lY3QgdGhlIHNoYXJkIHRvIHRoZSBnYXRld2F5LlxuICAgICAqL1xuICAgIGlkZW50aWZ5OiBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gYXdhaXQgaWRlbnRpZnlPdmVyd3JpdHRlbih0aGlzKTtcbiAgICB9LFxuXG4gICAgLyoqIENoZWNrIHdoZXRoZXIgdGhlIGNvbm5lY3Rpb24gdG8gRGlzY29yZCBpcyBjdXJyZW50bHkgb3Blbi4gKi9cbiAgICBpc09wZW46IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiBpc09wZW5PdmVyd3JpdHRlbih0aGlzKTtcbiAgICB9LFxuXG4gICAgLyoqIEZ1bmN0aW9uIHdoaWNoIGNhbiBiZSBvdmVyd3JpdHRlbiBpbiBvcmRlciB0byBnZXQgdGhlIHNoYXJkcyBwcmVzZW5jZS4gKi9cbiAgICAvLyBUaGlzIGZ1bmN0aW9uIGFsbG93cyB0byBiZSBhc3luYywgaW4gY2FzZSB0aGUgZGV2cyBjcmVhdGUgdGhlIHByZXNlbmNlIGJhc2VkIG9uIGVnLiBkYXRhYmFzZSB2YWx1ZXMuXG4gICAgLy8gUGFzc2luZyB0aGUgc2hhcmQncyBpZCB0aGVyZSB0byBtYWtlIGl0IGVhc2llciBmb3IgdGhlIGRldiB0byB1c2UgdGhpcyBmdW5jdGlvbi5cbiAgICBtYWtlUHJlc2VuY2U6IG9wdGlvbnMubWFrZVByZXNlbmNlLFxuXG4gICAgLyoqIEF0dGVtcHQgdG8gcmVzdW1lIHRoZSBwcmV2aW91cyBzaGFyZHMgc2Vzc2lvbiB3aXRoIHRoZSBnYXRld2F5LiAqL1xuICAgIHJlc3VtZTogYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIGF3YWl0IHJlc3VtZU92ZXJ3cml0dGVuKHRoaXMpO1xuICAgIH0sXG5cbiAgICAvKiogU2VuZCBhIG1lc3NhZ2UgdG8gRGlzY29yZC5cbiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IFtoaWdoUHJpb3JpdHk9ZmFsc2VdIC0gV2hldGhlciB0aGlzIG1lc3NhZ2Ugc2hvdWxkIGJlIHNlbmQgYXNhcC5cbiAgICAgKi9cbiAgICBzZW5kOiBhc3luYyBmdW5jdGlvbiAobWVzc2FnZTogU2hhcmRTb2NrZXRSZXF1ZXN0LCBoaWdoUHJpb3JpdHk6IGJvb2xlYW4gPSBmYWxzZSkge1xuICAgICAgcmV0dXJuIGF3YWl0IHNlbmRPdmVyd3JpdHRlbih0aGlzLCBtZXNzYWdlLCBoaWdoUHJpb3JpdHkpO1xuICAgIH0sXG5cbiAgICAvKiogU2h1dGRvd24gdGhlIHNoYXJkLlxuICAgICAqIEZvcmNlZnVsbHkgZGlzY29ubmVjdCB0aGUgc2hhcmQgZnJvbSBEaXNjb3JkLlxuICAgICAqIFRoZSBzaGFyZCBtYXkgbm90IGF0dGVtcHQgdG8gcmVjb25uZWN0IHdpdGggRGlzY29yZC5cbiAgICAgKi9cbiAgICBzaHV0ZG93bjogYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIGF3YWl0IHNodXRkb3duT3ZlcndyaXR0ZW4odGhpcyk7XG4gICAgfSxcblxuICAgIC8qKiBAcHJpdmF0ZSBJbnRlcm5hbCBzaGFyZCBidWNrZXQuXG4gICAgICogT25seSBhY2Nlc3MgdGhpcyBpZiB5b3Uga25vdyB3aGF0IHlvdSBhcmUgZG9pbmcuXG4gICAgICpcbiAgICAgKiBCdWNrZXQgZm9yIGhhbmRsaW5nIHNoYXJkIHJlcXVlc3QgcmF0ZSBsaW1pdHMuXG4gICAgICovXG4gICAgYnVja2V0OiBjcmVhdGVMZWFreUJ1Y2tldCh7XG4gICAgICBtYXg6IE1BWF9HQVRFV0FZX1JFUVVFU1RTX1BFUl9JTlRFUlZBTCxcbiAgICAgIHJlZmlsbEludGVydmFsOiBHQVRFV0FZX1JBVEVfTElNSVRfUkVTRVRfSU5URVJWQUwsXG4gICAgICByZWZpbGxBbW91bnQ6IE1BWF9HQVRFV0FZX1JFUVVFU1RTX1BFUl9JTlRFUlZBTCxcbiAgICB9KSxcblxuICAgIC8qKiBAcHJpdmF0ZSBJbnRlcm5hbCBzaGFyZCBmdW5jdGlvbi5cbiAgICAgKiBPbmx5IHVzZSB0aGlzIGZ1bmN0aW9uIGlmIHlvdSBrbm93IHdoYXQgeW91IGFyZSBkb2luZy5cbiAgICAgKlxuICAgICAqIEhhbmRsZSBhIGdhdGV3YXkgY29ubmVjdGlvbiBjbG9zZS5cbiAgICAgKi9cbiAgICBoYW5kbGVDbG9zZTogYXN5bmMgZnVuY3Rpb24gKGNsb3NlOiBDbG9zZUV2ZW50KSB7XG4gICAgICByZXR1cm4gYXdhaXQgaGFuZGxlQ2xvc2VPdmVyd3JpdHRlbih0aGlzLCBjbG9zZSk7XG4gICAgfSxcblxuICAgIC8qKiBAcHJpdmF0ZSBJbnRlcm5hbCBzaGFyZCBmdW5jdGlvbi5cbiAgICAgKiBPbmx5IHVzZSB0aGlzIGZ1bmN0aW9uIGlmIHlvdSBrbm93IHdoYXQgeW91IGFyZSBkb2luZy5cbiAgICAgKlxuICAgICAqIEhhbmRsZSBhbiBpbmNvbWluZyBnYXRld2F5IG1lc3NhZ2UuXG4gICAgICovXG4gICAgaGFuZGxlTWVzc2FnZTogYXN5bmMgZnVuY3Rpb24gKG1lc3NhZ2U6IE1lc3NhZ2VFdmVudDxhbnk+KSB7XG4gICAgICByZXR1cm4gYXdhaXQgaGFuZGxlTWVzc2FnZU92ZXJ3cml0dGVuKHRoaXMsIG1lc3NhZ2UpO1xuICAgIH0sXG5cbiAgICAvKiogVGhpcyBmdW5jdGlvbiBjb21tdW5pY2F0ZXMgd2l0aCB0aGUgbWFuYWdlbWVudCBwcm9jZXNzLCBpbiBvcmRlciB0byBrbm93IHdoZXRoZXIgaXRzIGZyZWUgdG8gaWRlbnRpZnkuICovXG4gICAgcmVxdWVzdElkZW50aWZ5OiBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gYXdhaXQgb3B0aW9ucy5yZXF1ZXN0SWRlbnRpZnkodGhpcy5pZCk7XG4gICAgfSxcblxuICAgIC8qKiBAcHJpdmF0ZSBJbnRlcm5hbCBzdGF0ZS5cbiAgICAgKiBPbmx5IHVzZSB0aGlzIGlmIHlvdSBrbm93IHdoYXQgeW91IGFyZSBkb2luZy5cbiAgICAgKlxuICAgICAqIENhY2hlIGZvciBwZW5kaW5nIGdhdGV3YXkgcmVxdWVzdHMgd2hpY2ggc2hvdWxkIGhhdmUgYmVlbiBzZW5kIHdoaWxlIHRoZSBnYXRld2F5IHdlbnQgb2ZmbGluZS5cbiAgICAgKi9cbiAgICBvZmZsaW5lU2VuZFF1ZXVlOiBbXSBhcyAoKF8/OiB1bmtub3duKSA9PiB2b2lkKVtdLFxuXG4gICAgLyoqIEBwcml2YXRlIEludGVybmFsIHNoYXJkIG1hcC5cbiAgICAgKiBPbmx5IHVzZSB0aGlzIG1hcCBpZiB5b3Uga25vdyB3aGF0IHlvdSBhcmUgZG9pbmcuXG4gICAgICpcbiAgICAgKiBUaGlzIGlzIHVzZWQgdG8gcmVzb2x2ZSBpbnRlcm5hbCB3YWl0aW5nIHN0YXRlcy5cbiAgICAgKiBNYXBwZWQgYnkgU2VsZWN0ZWRFdmVudHMgPT4gUmVzb2x2ZUZ1bmN0aW9uXG4gICAgICovXG4gICAgcmVzb2x2ZXM6IG5ldyBNYXA8XCJSRUFEWVwiIHwgXCJSRVNVTUVEXCIgfCBcIklOVkFMSURfU0VTU0lPTlwiLCAocGF5bG9hZDogRGlzY29yZEdhdGV3YXlQYXlsb2FkKSA9PiB2b2lkPigpLFxuXG4gICAgLyoqIEBwcml2YXRlIEludGVybmFsIHNoYXJkIGZ1bmN0aW9uLlxuICAgICAqIE9ubHkgdXNlIHRoaXMgZnVuY3Rpb24gaWYgeW91IGtub3cgd2hhdCB5b3UgYXJlIGRvaW5nLlxuICAgICAqXG4gICAgICogU3RhcnQgc2VuZGluZyBoZWFydGJlYXQgcGF5bG9hZHMgdG8gRGlzY29yZCBpbiB0aGUgcHJvdmlkZWQgaW50ZXJ2YWwuXG4gICAgICovXG4gICAgc3RhcnRIZWFydGJlYXRpbmc6IGZ1bmN0aW9uIChpbnRlcnZhbDogbnVtYmVyKSB7XG4gICAgICByZXR1cm4gc3RhcnRIZWFydGJlYXRpbmdPdmVyd3JpdHRlbih0aGlzLCBpbnRlcnZhbCk7XG4gICAgfSxcblxuICAgIC8qKiBAcHJpdmF0ZSBJbnRlcm5hbCBzaGFyZCBmdW5jdGlvbi5cbiAgICAgKiBPbmx5IHVzZSB0aGlzIGZ1bmN0aW9uIGlmIHlvdSBrbm93IHdoYXQgeW91IGFyZSBkb2luZy5cbiAgICAgKlxuICAgICAqIFN0b3AgdGhlIGhlYXJ0YmVhdGluZyBwcm9jZXNzIHdpdGggZGlzY29yZC5cbiAgICAgKi9cbiAgICBzdG9wSGVhcnRiZWF0aW5nOiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gc3RvcEhlYXJ0YmVhdGluZ092ZXJ3cml0dGVuKHRoaXMpO1xuICAgIH0sXG4gIH07XG59XG5cbi8vIGNvbnN0IHNoYXJkID0gY3JlYXRlU2hhcmQoe1xuLy8gICBpZDogMCxcbi8vICAgZ2F0ZXdheUNvbmZpZzoge1xuLy8gICAgIGNvbXByZXNzOiB0cnVlLFxuLy8gICAgIHVybDogXCJ3c3M6Ly9nYXRld2F5LmRpc2NvcmQuZ2dcIixcbi8vICAgICB2ZXJzaW9uOiAxMCxcbi8vICAgICBpbnRlbnRzOiAxIDw8IDEsXG4vLyAgICAgcHJvcGVydGllczoge1xuLy8gICAgICAgJG9zOiBcIkRpc2NvcmRlbm9cIixcbi8vICAgICAgICRicm93c2VyOiBcIkRpc2NvcmRlbm9cIixcbi8vICAgICAgICRkZXZpY2U6IFwiRGlzY29yZGVub1wiLFxuLy8gICAgIH0sXG4vLyAgICAgdG9rZW46IFRPS0VOLFxuLy8gICB9LFxuLy8gICB0b3RhbFNoYXJkczogMSxcbi8vICAgbWFrZVByZXNlbmNlOiAoc2hhcmRJZCkgPT4gKHtcbi8vICAgICBhY3Rpdml0aWVzOiBbXG4vLyAgICAgICB7XG4vLyAgICAgICAgIG5hbWU6IGBDYXJkcyBBZ2FpbnN0IEh1bWFuaXR5ICMke3NoYXJkSWR9YCxcbi8vICAgICAgICAgdHlwZTogMCxcbi8vICAgICAgICAgY3JlYXRlZEF0OiBEYXRlLm5vdygpLFxuLy8gICAgICAgfSxcbi8vICAgICBdLFxuLy8gICAgIHN0YXR1czogXCJkbmRcIixcbi8vICAgfSksXG4vLyAgIHJlcXVlc3RJZGVudGlmeTogYXN5bmMgKCkgPT4ge30sXG4vLyB9KTtcblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVTaGFyZCB7XG4gIC8qKiBJZCBvZiB0aGUgc2hhcmQgd2hpY2ggc2hvdWxkIGJlIGNyZWF0ZWQuICovXG4gIGlkOiBudW1iZXI7XG5cbiAgLyoqIEdhdGV3YXkgY29uZmlndXJhdGlvbiBmb3IgdGhlIHNoYXJkLiAqL1xuICBnYXRld2F5Q29uZmlnOiBQaWNrUGFydGlhbDxTaGFyZEdhdGV3YXlDb25maWcsIFwidG9rZW5cIj47XG5cbiAgLyoqIFRoZSB0b3RhbCBhbW91bnQgb2Ygc2hhcmRzIHdoaWNoIGFyZSB1c2VkIHRvIGNvbW11bmljYXRlIHdpdGggRGlzY29yZC4gKi9cbiAgdG90YWxTaGFyZHM6IG51bWJlcjtcblxuICAvKiogVGhpcyBmdW5jdGlvbiBjb21tdW5pY2F0ZXMgd2l0aCB0aGUgbWFuYWdlbWVudCBwcm9jZXNzLCBpbiBvcmRlciB0byBrbm93IHdoZXRoZXIgaXRzIGZyZWUgdG8gaWRlbnRpZnkuXG4gICAqIFdoZW4gdGhpcyBmdW5jdGlvbiByZXNvbHZlcywgdGhpcyBtZWFucyB0aGF0IHRoZSBzaGFyZCBpcyBhbGxvd2VkIHRvIHNlbmQgYW4gaWRlbnRpZnkgcGF5bG9hZCB0byBkaXNjb3JkLlxuICAgKi9cbiAgcmVxdWVzdElkZW50aWZ5OiAoc2hhcmRJZDogbnVtYmVyKSA9PiBQcm9taXNlPHZvaWQ+O1xuXG4gIC8qKiBDYWxjdWxhdGUgdGhlIGFtb3VudCBvZiByZXF1ZXN0cyB3aGljaCBjYW4gc2FmZWx5IGJlIG1hZGUgcGVyIHJhdGUgbGltaXQgaW50ZXJ2YWwsXG4gICAqIGJlZm9yZSB0aGUgZ2F0ZXdheSBnZXRzIGRpc2Nvbm5lY3RlZCBkdWUgdG8gYW4gZXhjZWVkZWQgcmF0ZSBsaW1pdC5cbiAgICovXG4gIGNhbGN1bGF0ZVNhZmVSZXF1ZXN0cz86IHR5cGVvZiBjYWxjdWxhdGVTYWZlUmVxdWVzdHM7XG5cbiAgLyoqIENsb3NlIHRoZSBzb2NrZXQgY29ubmVjdGlvbiB0byBkaXNjb3JkIGlmIHByZXNlbnQuICovXG4gIGNsb3NlPzogdHlwZW9mIGNsb3NlO1xuXG4gIC8qKiBDb25uZWN0IHRoZSBzaGFyZCB3aXRoIHRoZSBnYXRld2F5IGFuZCBzdGFydCBoZWFydGJlYXRpbmcuXG4gICAqIFRoaXMgd2lsbCBub3QgaWRlbnRpZnkgdGhlIHNoYXJkIHRvIHRoZSBnYXRld2F5LlxuICAgKi9cbiAgY29ubmVjdD86IHR5cGVvZiBjb25uZWN0O1xuXG4gIC8qKiBAcHJpdmF0ZSBJbnRlcm5hbCBzaGFyZCBmdW5jdGlvbi5cbiAgICogT25seSB1c2UgdGhpcyBmdW5jdGlvbiBpZiB5b3Uga25vdyB3aGF0IHlvdSBhcmUgZG9pbmcuXG4gICAqXG4gICAqIEhhbmRsZSBhIGdhdGV3YXkgY29ubmVjdGlvbiBjbG9zZS5cbiAgICovXG4gIGhhbmRsZUNsb3NlPzogdHlwZW9mIGhhbmRsZUNsb3NlO1xuXG4gIC8qKiBAcHJpdmF0ZSBJbnRlcm5hbCBzaGFyZCBmdW5jdGlvbi5cbiAgICogT25seSB1c2UgdGhpcyBmdW5jdGlvbiBpZiB5b3Uga25vdyB3aGF0IHlvdSBhcmUgZG9pbmcuXG4gICAqXG4gICAqIEhhbmRsZSBhbiBpbmNvbWluZyBnYXRld2F5IG1lc3NhZ2UuXG4gICAqL1xuICBoYW5kbGVNZXNzYWdlPzogdHlwZW9mIGhhbmRsZU1lc3NhZ2U7XG5cbiAgLyoqIElkZW50aWZ5IHRoZSBzaGFyZCB0byB0aGUgZ2F0ZXdheS5cbiAgICogSWYgbm90IGNvbm5lY3RlZCwgdGhpcyB3aWxsIGFsc28gY29ubmVjdCB0aGUgc2hhcmQgdG8gdGhlIGdhdGV3YXkuXG4gICAqL1xuICBpZGVudGlmeT86IHR5cGVvZiBpZGVudGlmeTtcblxuICAvKiogQ2hlY2sgd2hldGhlciB0aGUgY29ubmVjdGlvbiB0byBEaXNjb3JkIGlzIGN1cnJlbnRseSBvcGVuLiAqL1xuICBpc09wZW4/OiB0eXBlb2YgaXNPcGVuO1xuXG4gIC8qKiBGdW5jdGlvbiB3aGljaCBjYW4gYmUgb3ZlcndyaXR0ZW4gaW4gb3JkZXIgdG8gZ2V0IHRoZSBzaGFyZHMgcHJlc2VuY2UuICovXG4gIG1ha2VQcmVzZW5jZT8oc2hhcmRJZDogbnVtYmVyKTogUHJvbWlzZTxTdGF0dXNVcGRhdGU+IHwgU3RhdHVzVXBkYXRlO1xuXG4gIC8qKiBUaGUgbWF4aW11bSBvZiByZXF1ZXN0cyB3aGljaCBjYW4gYmUgc2VuZCB0byBkaXNjb3JkIHBlciByYXRlIGxpbWl0IHRpY2suXG4gICAqIFR5cGljYWxseSB0aGlzIHZhbHVlIHNob3VsZCBub3QgYmUgY2hhbmdlZC5cbiAgICovXG4gIG1heFJlcXVlc3RzUGVyUmF0ZUxpbWl0VGljaz86IG51bWJlcjtcblxuICAvKiogVGhlIHByZXZpb3VzIHBheWxvYWQgc2VxdWVuY2UgbnVtYmVyLiAqL1xuICBwcmV2aW91c1NlcXVlbmNlTnVtYmVyPzogbnVtYmVyO1xuXG4gIC8qKiBJbiB3aGljaCBpbnRlcnZhbCAoaW4gbWlsbGlzZWNvbmRzKSB0aGUgZ2F0ZXdheSByZXNldHMgaXQncyByYXRlIGxpbWl0LiAqL1xuICByYXRlTGltaXRSZXNldEludGVydmFsPzogbnVtYmVyO1xuXG4gIC8qKiBBdHRlbXB0IHRvIHJlc3VtZSB0aGUgcHJldmlvdXMgc2hhcmRzIHNlc3Npb24gd2l0aCB0aGUgZ2F0ZXdheS4gKi9cbiAgcmVzdW1lPzogdHlwZW9mIHJlc3VtZTtcblxuICAvKiogU2VuZCBhIG1lc3NhZ2UgdG8gRGlzY29yZC5cbiAgICogQHBhcmFtIHtib29sZWFufSBbaGlnaFByaW9yaXR5PWZhbHNlXSAtIFdoZXRoZXIgdGhpcyBtZXNzYWdlIHNob3VsZCBiZSBzZW5kIGFzYXAuXG4gICAqL1xuICBzZW5kPzogdHlwZW9mIHNlbmQ7XG5cbiAgLyoqIFNodXRkb3duIHRoZSBzaGFyZC5cbiAgICogRm9yY2VmdWxseSBkaXNjb25uZWN0IHRoZSBzaGFyZCBmcm9tIERpc2NvcmQuXG4gICAqIFRoZSBzaGFyZCBtYXkgbm90IGF0dGVtcHQgdG8gcmVjb25uZWN0IHdpdGggRGlzY29yZC5cbiAgICovXG4gIHNodXRkb3duPzogdHlwZW9mIHNodXRkb3duO1xuXG4gIC8qKiBAcHJpdmF0ZSBJbnRlcm5hbCBzaGFyZCBmdW5jdGlvbi5cbiAgICogT25seSB1c2UgdGhpcyBmdW5jdGlvbiBpZiB5b3Uga25vdyB3aGF0IHlvdSBhcmUgZG9pbmcuXG4gICAqXG4gICAqIFN0YXJ0IHNlbmRpbmcgaGVhcnRiZWF0IHBheWxvYWRzIHRvIERpc2NvcmQgaW4gdGhlIHByb3ZpZGVkIGludGVydmFsLlxuICAgKi9cbiAgc3RhcnRIZWFydGJlYXRpbmc/OiB0eXBlb2Ygc3RhcnRIZWFydGJlYXRpbmc7XG5cbiAgLyoqIEN1cnJlbnQgaW50ZXJuYWwgc3RhdGUgb2YgdGhlIHNoYXJkLiAqL1xuICBzdGF0ZT86IFNoYXJkU3RhdGU7XG5cbiAgLyoqIEBwcml2YXRlIEludGVybmFsIHNoYXJkIGZ1bmN0aW9uLlxuICAgKiBPbmx5IHVzZSB0aGlzIGZ1bmN0aW9uIGlmIHlvdSBrbm93IHdoYXQgeW91IGFyZSBkb2luZy5cbiAgICpcbiAgICogU3RvcCB0aGUgaGVhcnRiZWF0aW5nIHByb2Nlc3Mgd2l0aCBkaXNjb3JkLlxuICAgKi9cbiAgc3RvcEhlYXJ0YmVhdGluZz86IHR5cGVvZiBzdG9wSGVhcnRiZWF0aW5nO1xuXG4gIC8qKiBUaGUgc2hhcmQgcmVsYXRlZCBldmVudCBoYW5kbGVycy4gKi9cbiAgZXZlbnRzPzogU2hhcmRFdmVudHM7XG4gIC8qKiBUaGlzIGNvbnRhaW5zIGFsbCB0aGUgaGVhcnRiZWF0IGluZm9ybWF0aW9uICovXG4gIGhlYXJ0PzogU2hhcmRIZWFydDtcbiAgLyoqIEJ1Y2tldCBmb3IgaGFuZGxpbmcgc2hhcmQgcmVxdWVzdCByYXRlIGxpbWl0cy4gKi9cbiAgYnVja2V0PzogTGVha3lCdWNrZXQ7XG4gIC8qKiBDYWNoZSBmb3IgcGVuZGluZyBnYXRld2F5IHJlcXVlc3RzIHdoaWNoIHNob3VsZCBoYXZlIGJlZW4gc2VuZCB3aGlsZSB0aGUgZ2F0ZXdheSB3ZW50IG9mZmxpbmUuICovXG4gIG9mZmxpbmVTZW5kUXVldWU/OiBTaGFyZFNvY2tldFJlcXVlc3RbXTtcbiAgLyoqIFRoaXMgaXMgdXNlZCB0byByZXNvbHZlIGludGVybmFsIHdhaXRpbmcgc3RhdGVzLlxuICAgKiBNYXBwZWQgYnkgU2VsZWN0ZWRFdmVudHMgPT4gUmVzb2x2ZUZ1bmN0aW9uXG4gICAqL1xuICByZXNvbHZlcz86IFNoYXJkW1wicmVzb2x2ZXNcIl07XG59XG4iXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IlNBQVMsUUFBUSxRQUFRLGVBQWUsQ0FBQztBQUN6QyxTQUFTLGFBQWEsUUFBUSxvQkFBb0IsQ0FBQztBQUNuRCxTQUNFLDBCQUEwQixFQUMxQixpQ0FBaUMsRUFDakMsaUNBQWlDLEVBT2pDLFVBQVUsUUFDTCxZQUFZLENBQUM7QUFFcEIsU0FBUyxpQkFBaUIsUUFBUSx3QkFBd0IsQ0FBQztBQUMzRCxTQUFTLGdCQUFnQixRQUFRLHVCQUF1QixDQUFDO0FBQ3pELFNBQVMsTUFBTSxRQUFRLGFBQWEsQ0FBQztBQUNyQyxTQUFTLGlCQUFpQixRQUFxQixzQkFBc0Is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