import { statusTypes } from "../../transformers/presence.ts";
export async function handleGuildMembersChunk(bot, data) {
    const payload = data.d;
    const guildId = bot.transformers.snowflake(payload.guild_id);
    if (payload.nonce && payload.chunk_index >= payload.chunk_count - 1) {
        bot.cache.fetchAllMembersProcessingRequests.get(payload.nonce)?.(`Member fetching complete. Nonce: ${payload.nonce}`);
    }
    return {
        guildId,
        members: payload.members.map((m)=>bot.transformers.member(bot, m, guildId, bot.transformers.snowflake(m.user.id))
        ),
        chunkIndex: payload.chunk_index,
        chunkCount: payload.chunk_count,
        notFound: payload.not_found?.map((id)=>bot.transformers.snowflake(id)
        ),
        presences: payload.presences?.map((presence)=>({
                user: bot.transformers.user(bot, presence.user),
                guildId,
                status: statusTypes[presence.status],
                activities: presence.activities.map((activity)=>bot.transformers.activity(bot, activity)
                ),
                clientStatus: {
                    desktop: presence.client_status.desktop,
                    mobile: presence.client_status.mobile,
                    web: presence.client_status.web
                }
            })
        ),
        nonce: payload.nonce
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBCb3QgfSBmcm9tIFwiLi4vLi4vYm90LnRzXCI7XG5pbXBvcnQgeyBzdGF0dXNUeXBlcyB9IGZyb20gXCIuLi8uLi90cmFuc2Zvcm1lcnMvcHJlc2VuY2UudHNcIjtcbmltcG9ydCB7IERpc2NvcmRHYXRld2F5UGF5bG9hZCwgRGlzY29yZEd1aWxkTWVtYmVyc0NodW5rIH0gZnJvbSBcIi4uLy4uL3R5cGVzL2Rpc2NvcmQudHNcIjtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGhhbmRsZUd1aWxkTWVtYmVyc0NodW5rKGJvdDogQm90LCBkYXRhOiBEaXNjb3JkR2F0ZXdheVBheWxvYWQpIHtcbiAgY29uc3QgcGF5bG9hZCA9IGRhdGEuZCBhcyBEaXNjb3JkR3VpbGRNZW1iZXJzQ2h1bms7XG5cbiAgY29uc3QgZ3VpbGRJZCA9IGJvdC50cmFuc2Zvcm1lcnMuc25vd2ZsYWtlKHBheWxvYWQuZ3VpbGRfaWQpO1xuXG4gIGlmIChwYXlsb2FkLm5vbmNlICYmIHBheWxvYWQuY2h1bmtfaW5kZXggPj0gcGF5bG9hZC5jaHVua19jb3VudCAtIDEpIHtcbiAgICBib3QuY2FjaGUuZmV0Y2hBbGxNZW1iZXJzUHJvY2Vzc2luZ1JlcXVlc3RzLmdldChwYXlsb2FkLm5vbmNlKT8uKFxuICAgICAgYE1lbWJlciBmZXRjaGluZyBjb21wbGV0ZS4gTm9uY2U6ICR7cGF5bG9hZC5ub25jZX1gLFxuICAgICk7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIGd1aWxkSWQsXG4gICAgbWVtYmVyczogcGF5bG9hZC5tZW1iZXJzLm1hcCgobSkgPT5cbiAgICAgIGJvdC50cmFuc2Zvcm1lcnMubWVtYmVyKGJvdCwgbSwgZ3VpbGRJZCwgYm90LnRyYW5zZm9ybWVycy5zbm93Zmxha2UobS51c2VyLmlkKSlcbiAgICApLFxuICAgIGNodW5rSW5kZXg6IHBheWxvYWQuY2h1bmtfaW5kZXgsXG4gICAgY2h1bmtDb3VudDogcGF5bG9hZC5jaHVua19jb3VudCxcbiAgICBub3RGb3VuZDogcGF5bG9hZC5ub3RfZm91bmQ/Lm1hcCgoaWQpID0+IGJvdC50cmFuc2Zvcm1lcnMuc25vd2ZsYWtlKGlkKSksXG4gICAgcHJlc2VuY2VzOiBwYXlsb2FkLnByZXNlbmNlcz8ubWFwKChwcmVzZW5jZSkgPT4gKHtcbiAgICAgIHVzZXI6IGJvdC50cmFuc2Zvcm1lcnMudXNlcihib3QsIHByZXNlbmNlLnVzZXIpLFxuICAgICAgZ3VpbGRJZCxcbiAgICAgIHN0YXR1czogc3RhdHVzVHlwZXNbcHJlc2VuY2Uuc3RhdHVzXSxcbiAgICAgIGFjdGl2aXRpZXM6IHByZXNlbmNlLmFjdGl2aXRpZXMubWFwKChhY3Rpdml0eSkgPT4gYm90LnRyYW5zZm9ybWVycy5hY3Rpdml0eShib3QsIGFjdGl2aXR5KSksXG4gICAgICBjbGllbnRTdGF0dXM6IHtcbiAgICAgICAgZGVza3RvcDogcHJlc2VuY2UuY2xpZW50X3N0YXR1cy5kZXNrdG9wLFxuICAgICAgICBtb2JpbGU6IHByZXNlbmNlLmNsaWVudF9zdGF0dXMubW9iaWxlLFxuICAgICAgICB3ZWI6IHByZXNlbmNlLmNsaWVudF9zdGF0dXMud2ViLFxuICAgICAgfSxcbiAgICB9KSksXG4gICAgbm9uY2U6IHBheWxvYWQubm9uY2UsXG4gIH07XG59XG4iXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsU0FBUyxXQUFXLFFBQVEsZ0NBQWdDLENBQUM7QUFHN0QsT0FBTyxlQUFlLHVCQUF1QixDQUFDLEdBQVEsRUFBRSxJQUEyQixFQUFFO0lBQ25GLE1BQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxDQUFDLEFBQTRCLEFBQUM7SUFFbkQsTUFBTSxPQUFPLEdBQUcsR0FBRyxDQUFDLFlBQVksQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxBQUFDO0lBRTdELElBQUksT0FBTyxDQUFDLEtBQUssSUFBSSxPQUFPLENBQUMsV0FBVyxJQUFJLE9BQU8sQ0FBQyxXQUFXLEdBQUcsQ0FBQyxFQUFFO1FBQ25FLEdBQUcsQ0FBQyxLQUFLLENBQUMsaUNBQWlDLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsR0FDNUQsQ0FBQyxpQ0FBaUMsRUFBRSxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FDcEQsQ0FBQztLQUNIO0lBRUQsT0FBTztRQUNMLE9BQU87UUFDUCxPQUFPLEVBQUUsT0FBTyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEdBQzdCLEdBQUcsQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDLEdBQUcsRUFBRSxDQUFDLEVBQUUsT0FBTyxFQUFFLEdBQUcsQ0FBQyxZQUFZLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7UUFBQSxDQUNoRjtRQUNELFVBQVUsRUFBRSxPQUFPLENBQUMsV0FBVztRQUMvQixVQUFVLEVBQUUsT0FBTyxDQUFDLFdBQVc7UUFDL0IsUUFBUSxFQUFFLE9BQU8sQ0FBQyxTQUFTLEVBQUUsR0FBRyxDQUFDLENBQUMsRUFBRSxHQUFLLEdBQUcsQ0FBQyxZQUFZLENBQUMsU0FBUyxDQUFDLEVBQUUsQ0FBQztRQUFBLENBQUM7UUFDeEUsU0FBUyxFQUFFLE9BQU8sQ0FBQyxTQUFTLEVBQUUsR0FBRyxDQUFDLENBQUMsUUFBUSxHQUFLLENBQUM7Z0JBQy9DLElBQUksRUFBRSxHQUFHLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsUUFBUSxDQUFDLElBQUksQ0FBQztnQkFDL0MsT0FBTztnQkFDUCxNQUFNLEVBQUUsV0FBVyxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUM7Z0JBQ3BDLFVBQVUsRUFBRSxRQUFRLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxDQUFDLFFBQVEsR0FBSyxHQUFHLENBQUMsWUFBWSxDQUFDLFFBQVEsQ0FBQyxHQUFHLEVBQUUsUUFBUSxDQUFDO2dCQUFBLENBQUM7Z0JBQzNGLFlBQVksRUFBRTtvQkFDWixPQUFPLEVBQUUsUUFBUSxDQUFDLGFBQWEsQ0FBQyxPQUFPO29CQUN2QyxNQUFNLEVBQUUsUUFBUSxDQUFDLGFBQWEsQ0FBQyxNQUFNO29CQUNyQyxHQUFHLEVBQUUsUUFBUSxDQUFDLGFBQWEsQ0FBQyxHQUFHO2lCQUNoQzthQUNGLENBQUM7UUFBQSxDQUFDO1FBQ0gsS0FBSyxFQUFFLE9BQU8sQ0FBQyxLQUFLO0tBQ3JCLENBQUM7Q0FDSCJ9