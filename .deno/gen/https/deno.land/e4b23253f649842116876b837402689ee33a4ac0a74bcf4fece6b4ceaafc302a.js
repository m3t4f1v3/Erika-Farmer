import { MessageComponentTypes } from "../../types/shared.ts";
export async function sendInteractionResponse(bot, id, token, options) {
    if (!options.data?.allowedMentions) {
        options.data = { ...options.data, allowedMentions: { parse: [] } };
    }
    const data = {
        content: options.data.content,
        tts: options.data.tts,
        embeds: options.data.embeds?.map((embed) => bot.transformers.reverse.embed(bot, embed)),
        allowed_mentions: {
            parse: options.data.allowedMentions.parse,
            replied_user: options.data.allowedMentions.repliedUser,
            users: options.data.allowedMentions.users?.map((id) => id.toString()),
            roles: options.data.allowedMentions.roles?.map((id) => id.toString()),
        },
        custom_id: options.data.customId,
        title: options.data.title,
        components: options.data.components?.map((component) => ({
            type: component.type,
            components: component.components.map((subComponent) => {
                if (subComponent.type === MessageComponentTypes.InputText) {
                    return {
                        type: subComponent.type,
                        style: subComponent.style,
                        custom_id: subComponent.customId,
                        label: subComponent.label,
                        placeholder: subComponent.placeholder,
                        value: subComponent.value,
                        min_length: subComponent.minLength,
                        max_length: subComponent.maxLength,
                        required: subComponent.required,
                    };
                }
                if (subComponent.type === MessageComponentTypes.SelectMenu) {
                    return {
                        type: subComponent.type,
                        custom_id: subComponent.customId,
                        placeholder: subComponent.placeholder,
                        min_values: subComponent.minValues,
                        max_values: subComponent.maxValues,
                        options: subComponent.options.map((option) => ({
                            label: option.label,
                            value: option.value,
                            description: option.description,
                            emoji: option.emoji
                                ? {
                                    id: option.emoji.id?.toString(),
                                    name: option.emoji.name,
                                    animated: option.emoji.animated,
                                }
                                : undefined,
                            default: option.default,
                        })),
                    };
                }
                return {
                    type: subComponent.type,
                    custom_id: subComponent.customId,
                    label: subComponent.label,
                    style: subComponent.style,
                    emoji: "emoji" in subComponent && subComponent.emoji
                        ? {
                            id: subComponent.emoji.id?.toString(),
                            name: subComponent.emoji.name,
                            animated: subComponent.emoji.animated,
                        }
                        : undefined,
                    url: "url" in subComponent ? subComponent.url : undefined,
                    disabled: "disabled" in subComponent ? subComponent.disabled : undefined,
                };
            }),
        })),
        flags: options.data.flags,
        choices: options.data.choices,
    };
    if (bot.cache.unrepliedInteractions.delete(id)) {
        return await bot.rest.runMethod(bot.rest, "POST", bot.constants.routes.INTERACTION_ID_TOKEN(id, token), {
            type: options.type,
            data,
            file: options.data.file,
        });
    }
    const result = await bot.rest.runMethod(bot.rest, "POST", bot.constants.routes.WEBHOOK(bot.applicationId, token), { ...data, file: options.data.file });
    return bot.transformers.message(bot, result);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VuZEludGVyYWN0aW9uUmVzcG9uc2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJzZW5kSW50ZXJhY3Rpb25SZXNwb25zZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFJQSxPQUFPLEVBQTRCLHFCQUFxQixFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFReEYsTUFBTSxDQUFDLEtBQUssVUFBVSx1QkFBdUIsQ0FDM0MsR0FBUSxFQUNSLEVBQVUsRUFDVixLQUFhLEVBQ2IsT0FBNEI7SUFHNUIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsZUFBZSxFQUFFO1FBQ2xDLE9BQU8sQ0FBQyxJQUFJLEdBQUcsRUFBRSxHQUFHLE9BQU8sQ0FBQyxJQUFJLEVBQUUsZUFBZSxFQUFFLEVBQUUsS0FBSyxFQUFFLEVBQUUsRUFBRSxFQUFFLENBQUM7S0FDcEU7SUFHRCxNQUFNLElBQUksR0FBRztRQUNYLE9BQU8sRUFBRSxPQUFPLENBQUMsSUFBSSxDQUFDLE9BQU87UUFDN0IsR0FBRyxFQUFFLE9BQU8sQ0FBQyxJQUFJLENBQUMsR0FBRztRQUNyQixNQUFNLEVBQUUsT0FBTyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsR0FBRyxDQUFDLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxHQUFHLENBQUMsWUFBWSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsR0FBRyxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQ3ZGLGdCQUFnQixFQUFFO1lBQ2hCLEtBQUssRUFBRSxPQUFPLENBQUMsSUFBSSxDQUFDLGVBQWdCLENBQUMsS0FBSztZQUMxQyxZQUFZLEVBQUUsT0FBTyxDQUFDLElBQUksQ0FBQyxlQUFnQixDQUFDLFdBQVc7WUFDdkQsS0FBSyxFQUFFLE9BQU8sQ0FBQyxJQUFJLENBQUMsZUFBZ0IsQ0FBQyxLQUFLLEVBQUUsR0FBRyxDQUFDLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUMsUUFBUSxFQUFFLENBQUM7WUFDdEUsS0FBSyxF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QUFDLENBQUM7QUFDL0MsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgQm90IH0gZnJvbSBcIi4uLy4uL2JvdC50c1wiO1xuaW1wb3J0IHsgRW1iZWQgfSBmcm9tIFwiLi4vLi4vbW9kLnRzXCI7XG5pbXBvcnQgeyBEaXNjb3JkTWVzc2FnZSB9IGZyb20gXCIuLi8uLi90eXBlcy9kaXNjb3JkLnRzXCI7XG5pbXBvcnQgeyBBbGxvd2VkTWVudGlvbnMsIEZpbGVDb250ZW50LCBNZXNzYWdlQ29tcG9uZW50cyB9IGZyb20gXCIuLi8uLi90eXBlcy9kaXNjb3JkZW5vLnRzXCI7XG5pbXBvcnQgeyBJbnRlcmFjdGlvblJlc3BvbnNlVHlwZXMsIE1lc3NhZ2VDb21wb25lbnRUeXBlcyB9IGZyb20gXCIuLi8uLi90eXBlcy9zaGFyZWQudHNcIjtcblxuLyoqXG4gKiBTZW5kIGEgcmVzcG9uc2UgdG8gYSB1c2VycyBhcHBsaWNhdGlvbiBjb21tYW5kLiBUaGUgY29tbWFuZCBkYXRhIHdpbGwgaGF2ZSB0aGUgaWQgYW5kIHRva2VuIG5lY2Vzc2FyeSB0byByZXNwb25kLlxuICogSW50ZXJhY3Rpb24gYHRva2Vuc2AgYXJlIHZhbGlkIGZvciAqKjE1IG1pbnV0ZXMqKiBhbmQgY2FuIGJlIHVzZWQgdG8gc2VuZCBmb2xsb3d1cCBtZXNzYWdlcy5cbiAqXG4gKiBOT1RFOiBCeSBkZWZhdWx0IHdlIHdpbGwgc3VwcHJlc3MgbWVudGlvbnMuIFRvIGVuYWJsZSBtZW50aW9ucywganVzdCBwYXNzIGFueSBtZW50aW9ucyBvYmplY3QuXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzZW5kSW50ZXJhY3Rpb25SZXNwb25zZShcbiAgYm90OiBCb3QsXG4gIGlkOiBiaWdpbnQsXG4gIHRva2VuOiBzdHJpbmcsXG4gIG9wdGlvbnM6IEludGVyYWN0aW9uUmVzcG9uc2UsXG4pIHtcbiAgLy8gSWYgbm8gbWVudGlvbnMgYXJlIHByb3ZpZGVkLCBmb3JjZSBkaXNhYmxlIG1lbnRpb25zXG4gIGlmICghb3B0aW9ucy5kYXRhPy5hbGxvd2VkTWVudGlvbnMpIHtcbiAgICBvcHRpb25zLmRhdGEgPSB7IC4uLm9wdGlvbnMuZGF0YSwgYWxsb3dlZE1lbnRpb25zOiB7IHBhcnNlOiBbXSB9IH07XG4gIH1cblxuICAvLyBEUlkgY29kZSBhIGxpdHRsZSBiaXRcbiAgY29uc3QgZGF0YSA9IHtcbiAgICBjb250ZW50OiBvcHRpb25zLmRhdGEuY29udGVudCxcbiAgICB0dHM6IG9wdGlvbnMuZGF0YS50dHMsXG4gICAgZW1iZWRzOiBvcHRpb25zLmRhdGEuZW1iZWRzPy5tYXAoKGVtYmVkKSA9PiBib3QudHJhbnNmb3JtZXJzLnJldmVyc2UuZW1iZWQoYm90LCBlbWJlZCkpLFxuICAgIGFsbG93ZWRfbWVudGlvbnM6IHtcbiAgICAgIHBhcnNlOiBvcHRpb25zLmRhdGEuYWxsb3dlZE1lbnRpb25zIS5wYXJzZSxcbiAgICAgIHJlcGxpZWRfdXNlcjogb3B0aW9ucy5kYXRhLmFsbG93ZWRNZW50aW9ucyEucmVwbGllZFVzZXIsXG4gICAgICB1c2Vyczogb3B0aW9ucy5kYXRhLmFsbG93ZWRNZW50aW9ucyEudXNlcnM/Lm1hcCgoaWQpID0+IGlkLnRvU3RyaW5nKCkpLFxuICAgICAgcm9sZXM6IG9wdGlvbnMuZGF0YS5hbGxvd2VkTWVudGlvbnMhLnJvbGVzPy5tYXAoKGlkKSA9PiBpZC50b1N0cmluZygpKSxcbiAgICB9LFxuICAgIGN1c3RvbV9pZDogb3B0aW9ucy5kYXRhLmN1c3RvbUlkLFxuICAgIHRpdGxlOiBvcHRpb25zLmRhdGEudGl0bGUsXG4gICAgY29tcG9uZW50czogb3B0aW9ucy5kYXRhLmNvbXBvbmVudHM/Lm1hcCgoY29tcG9uZW50KSA9PiAoe1xuICAgICAgdHlwZTogY29tcG9uZW50LnR5cGUsXG4gICAgICBjb21wb25lbnRzOiBjb21wb25lbnQuY29tcG9uZW50cy5tYXAoKHN1YkNvbXBvbmVudCkgPT4ge1xuICAgICAgICBpZiAoc3ViQ29tcG9uZW50LnR5cGUgPT09IE1lc3NhZ2VDb21wb25lbnRUeXBlcy5JbnB1dFRleHQpIHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdHlwZTogc3ViQ29tcG9uZW50LnR5cGUsXG4gICAgICAgICAgICBzdHlsZTogc3ViQ29tcG9uZW50LnN0eWxlLFxuICAgICAgICAgICAgY3VzdG9tX2lkOiBzdWJDb21wb25lbnQuY3VzdG9tSWQsXG4gICAgICAgICAgICBsYWJlbDogc3ViQ29tcG9uZW50LmxhYmVsLFxuICAgICAgICAgICAgcGxhY2Vob2xkZXI6IHN1YkNvbXBvbmVudC5wbGFjZWhvbGRlcixcbiAgICAgICAgICAgIHZhbHVlOiBzdWJDb21wb25lbnQudmFsdWUsXG4gICAgICAgICAgICBtaW5fbGVuZ3RoOiBzdWJDb21wb25lbnQubWluTGVuZ3RoLFxuICAgICAgICAgICAgbWF4X2xlbmd0aDogc3ViQ29tcG9uZW50Lm1heExlbmd0aCxcbiAgICAgICAgICAgIHJlcXVpcmVkOiBzdWJDb21wb25lbnQucmVxdWlyZWQsXG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChzdWJDb21wb25lbnQudHlwZSA9PT0gTWVzc2FnZUNvbXBvbmVudFR5cGVzLlNlbGVjdE1lbnUpIHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdHlwZTogc3ViQ29tcG9uZW50LnR5cGUsXG4gICAgICAgICAgICBjdXN0b21faWQ6IHN1YkNvbXBvbmVudC5jdXN0b21JZCxcbiAgICAgICAgICAgIHBsYWNlaG9sZGVyOiBzdWJDb21wb25lbnQucGxhY2Vob2xkZXIsXG4gICAgICAgICAgICBtaW5fdmFsdWVzOiBzdWJDb21wb25lbnQubWluVmFsdWVzLFxuICAgICAgICAgICAgbWF4X3ZhbHVlczogc3ViQ29tcG9uZW50Lm1heFZhbHVlcyxcbiAgICAgICAgICAgIG9wdGlvbnM6IHN1YkNvbXBvbmVudC5vcHRpb25zLm1hcCgob3B0aW9uKSA9PiAoe1xuICAgICAgICAgICAgICBsYWJlbDogb3B0aW9uLmxhYmVsLFxuICAgICAgICAgICAgICB2YWx1ZTogb3B0aW9uLnZhbHVlLFxuICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogb3B0aW9uLmRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgICBlbW9qaTogb3B0aW9uLmVtb2ppXG4gICAgICAgICAgICAgICAgPyB7XG4gICAgICAgICAgICAgICAgICBpZDogb3B0aW9uLmVtb2ppLmlkPy50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgICAgbmFtZTogb3B0aW9uLmVtb2ppLm5hbWUsXG4gICAgICAgICAgICAgICAgICBhbmltYXRlZDogb3B0aW9uLmVtb2ppLmFuaW1hdGVkLFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICA6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgZGVmYXVsdDogb3B0aW9uLmRlZmF1bHQsXG4gICAgICAgICAgICB9KSksXG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgdHlwZTogc3ViQ29tcG9uZW50LnR5cGUsXG4gICAgICAgICAgY3VzdG9tX2lkOiBzdWJDb21wb25lbnQuY3VzdG9tSWQsXG4gICAgICAgICAgbGFiZWw6IHN1YkNvbXBvbmVudC5sYWJlbCxcbiAgICAgICAgICBzdHlsZTogc3ViQ29tcG9uZW50LnN0eWxlLFxuICAgICAgICAgIGVtb2ppOiBcImVtb2ppXCIgaW4gc3ViQ29tcG9uZW50ICYmIHN1YkNvbXBvbmVudC5lbW9qaVxuICAgICAgICAgICAgPyB7XG4gICAgICAgICAgICAgIGlkOiBzdWJDb21wb25lbnQuZW1vamkuaWQ/LnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgIG5hbWU6IHN1YkNvbXBvbmVudC5lbW9qaS5uYW1lLFxuICAgICAgICAgICAgICBhbmltYXRlZDogc3ViQ29tcG9uZW50LmVtb2ppLmFuaW1hdGVkLFxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgOiB1bmRlZmluZWQsXG4gICAgICAgICAgdXJsOiBcInVybFwiIGluIHN1YkNvbXBvbmVudCA/IHN1YkNvbXBvbmVudC51cmwgOiB1bmRlZmluZWQsXG4gICAgICAgICAgZGlzYWJsZWQ6IFwiZGlzYWJsZWRcIiBpbiBzdWJDb21wb25lbnQgPyBzdWJDb21wb25lbnQuZGlzYWJsZWQgOiB1bmRlZmluZWQsXG4gICAgICAgIH07XG4gICAgICB9KSxcbiAgICB9KSksXG4gICAgZmxhZ3M6IG9wdGlvbnMuZGF0YS5mbGFncyxcbiAgICBjaG9pY2VzOiBvcHRpb25zLmRhdGEuY2hvaWNlcyxcbiAgfTtcblxuICAvLyBBIHJlcGx5IGhhcyBuZXZlciBiZWVuIHNlbmRcbiAgaWYgKGJvdC5jYWNoZS51bnJlcGxpZWRJbnRlcmFjdGlvbnMuZGVsZXRlKGlkKSkge1xuICAgIHJldHVybiBhd2FpdCBib3QucmVzdC5ydW5NZXRob2Q8dW5kZWZpbmVkPihcbiAgICAgIGJvdC5yZXN0LFxuICAgICAgXCJQT1NUXCIsXG4gICAgICBib3QuY29uc3RhbnRzLnJvdXRlcy5JTlRFUkFDVElPTl9JRF9UT0tFTihpZCwgdG9rZW4pLFxuICAgICAge1xuICAgICAgICB0eXBlOiBvcHRpb25zLnR5cGUsXG4gICAgICAgIGRhdGEsXG4gICAgICAgIGZpbGU6IG9wdGlvbnMuZGF0YS5maWxlLFxuICAgICAgfSxcbiAgICApO1xuICB9XG5cbiAgLy8gSWYgaXRzIGFscmVhZHkgYmVlbiBleGVjdXRlZCwgd2UgbmVlZCB0byBzZW5kIGEgZm9sbG93dXAgcmVzcG9uc2VcbiAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYm90LnJlc3QucnVuTWV0aG9kPERpc2NvcmRNZXNzYWdlPihcbiAgICBib3QucmVzdCxcbiAgICBcIlBPU1RcIixcbiAgICBib3QuY29uc3RhbnRzLnJvdXRlcy5XRUJIT09LKGJvdC5hcHBsaWNhdGlvbklkLCB0b2tlbiksXG4gICAgeyAuLi5kYXRhLCBmaWxlOiBvcHRpb25zLmRhdGEuZmlsZSB9LFxuICApO1xuXG4gIHJldHVybiBib3QudHJhbnNmb3JtZXJzLm1lc3NhZ2UoYm90LCByZXN1bHQpO1xufVxuXG4vKiogaHR0cHM6Ly9kaXNjb3JkLmNvbS9kZXZlbG9wZXJzL2RvY3MvaW50ZXJhY3Rpb25zL3NsYXNoLWNvbW1hbmRzI2ludGVyYWN0aW9uLXJlc3BvbnNlICovXG5leHBvcnQgaW50ZXJmYWNlIEludGVyYWN0aW9uUmVzcG9uc2Uge1xuICAvKiogVGhlIHR5cGUgb2YgcmVzcG9uc2UgKi9cbiAgdHlwZTogSW50ZXJhY3Rpb25SZXNwb25zZVR5cGVzO1xuICAvKiogQW4gb3B0aW9uYWwgcmVzcG9uc2UgbWVzc2FnZSAqL1xuICBkYXRhPzogSW50ZXJhY3Rpb25BcHBsaWNhdGlvbkNvbW1hbmRDYWxsYmFja0RhdGE7XG59XG5cbi8qKiBodHRwczovL2Rpc2NvcmQuY29tL2RldmVsb3BlcnMvZG9jcy9pbnRlcmFjdGlvbnMvc2xhc2gtY29tbWFuZHMjaW50ZXJhY3Rpb24tcmVzcG9uc2UtaW50ZXJhY3Rpb25hcHBsaWNhdGlvbmNvbW1hbmRjYWxsYmFja2RhdGEgKi9cbmV4cG9ydCBpbnRlcmZhY2UgSW50ZXJhY3Rpb25BcHBsaWNhdGlvbkNvbW1hbmRDYWxsYmFja0RhdGEge1xuICAvKiogVGhlIG1lc3NhZ2UgY29udGVudHMgKHVwIHRvIDIwMDAgY2hhcmFjdGVycykgKi9cbiAgY29udGVudD86IHN0cmluZztcbiAgLyoqIFRydWUgaWYgdGhpcyBpcyBhIFRUUyBtZXNzYWdlICovXG4gIHR0cz86IGJvb2xlYW47XG4gIC8qKiBFbWJlZGRlZCBgcmljaGAgY29udGVudCAodXAgdG8gNjAwMCBjaGFyYWN0ZXJzKSAqL1xuICBlbWJlZHM/OiBFbWJlZFtdO1xuICAvKiogQWxsb3dlZCBtZW50aW9ucyBmb3IgdGhlIG1lc3NhZ2UgKi9cbiAgYWxsb3dlZE1lbnRpb25zPzogQWxsb3dlZE1lbnRpb25zO1xuICAvKiogVGhlIGNvbnRlbnRzIG9mIHRoZSBmaWxlIGJlaW5nIHNlbnQgKi9cbiAgZmlsZT86IEZpbGVDb250ZW50IHwgRmlsZUNvbnRlbnRbXTtcbiAgLyoqIFRoZSBjdXN0b21JZCB5b3Ugd2FudCB0byB1c2UgZm9yIHRoaXMgbW9kYWwgcmVzcG9uc2UuICovXG4gIGN1c3RvbUlkPzogc3RyaW5nO1xuICAvKiogVGhlIHRpdGxlIHlvdSB3YW50IHRvIHVzZSBmb3IgdGhpcyBtb2RhbCByZXNwb25zZS4gKi9cbiAgdGl0bGU/OiBzdHJpbmc7XG4gIC8qKiBUaGUgY29tcG9uZW50cyB5b3Ugd291bGQgbGlrZSB0byBoYXZlIHNlbnQgaW4gdGhpcyBtZXNzYWdlICovXG4gIGNvbXBvbmVudHM/OiBNZXNzYWdlQ29tcG9uZW50cztcbiAgLyoqIE1lc3NhZ2UgZmxhZ3MgY29tYmluZWQgYXMgYSBiaXQgZmllbGQgKG9ubHkgU1VQUFJFU1NfRU1CRURTIGFuZCBFUEhFTUVSQUwgY2FuIGJlIHNldCkgKi9cbiAgZmxhZ3M/OiBudW1iZXI7XG4gIC8qKiBBdXRvY29tcGxldGUgY2hvaWNlcyAobWF4IG9mIDI1IGNob2ljZXMpICovXG4gIGNob2ljZXM/OiBBcHBsaWNhdGlvbkNvbW1hbmRPcHRpb25DaG9pY2VbXTtcbn1cblxuLyoqIGh0dHBzOi8vZGlzY29yZC5jb20vZGV2ZWxvcGVycy9kb2NzL2ludGVyYWN0aW9ucy9zbGFzaC1jb21tYW5kcyNhcHBsaWNhdGlvbmNvbW1hbmRvcHRpb25jaG9pY2UgKi9cbmV4cG9ydCBpbnRlcmZhY2UgQXBwbGljYXRpb25Db21tYW5kT3B0aW9uQ2hvaWNlIHtcbiAgLyoqIDEtMTAwIGNoYXJhY3RlciBjaG9pY2UgbmFtZSAqL1xuICBuYW1lOiBzdHJpbmc7XG4gIC8qKiBWYWx1ZSBvZiB0aGUgY2hvaWNlLCB1cCB0byAxMDAgY2hhcmFjdGVycyBpZiBzdHJpbmcgKi9cbiAgdmFsdWU6IHN0cmluZyB8IG51bWJlcjtcbn1cbiJdfQ==