import { ChannelTypes } from "../../deps.ts";
import { requireBotChannelPermissions } from "../permissions.ts";
export default function editChannel(bot) {
    const editChannelOld = bot.helpers.editChannel;
    bot.helpers.editChannel = async function (channelId, options, reason) {
        const channel = bot.channels.get(channelId);
        if (channel?.guildId) {
            const guild = bot.guilds.get(channel.guildId);
            if (options.rateLimitPerUser && options.rateLimitPerUser > 21600) {
                throw new Error("Amount of seconds a user has to wait before sending another message must be between 0-21600");
            }
            if (options.name) {
                if (!bot.utils.validateLength(options.name, { min: 1, max: 100 })) {
                    throw new Error("The channel name must be between 1-100 characters.");
                }
            }
            const isThread = [
                ChannelTypes.GuildNewsThread,
                ChannelTypes.GuildPublicThread,
                ChannelTypes.GuildPrivateThread,
            ].includes(channel.type);
            const requiredPerms = [];
            if (isThread) {
                if (options.invitable !== undefined &&
                    channel.type !== ChannelTypes.GuildPrivateThread) {
                    throw new Error("Invitable option is only allowed on private threads.");
                }
                if (!channel.locked && options.archived === false) {
                    requiredPerms.push("SEND_MESSAGES");
                    if (Object.keys(options).length > 1) {
                        requiredPerms.push("MANAGE_THREADS");
                    }
                }
                else {
                    requiredPerms.push("MANAGE_THREADS");
                }
            }
            else {
                requiredPerms.push("MANAGE_CHANNELS");
                if (options.permissionOverwrites) {
                    requiredPerms.push("MANAGE_ROLES");
                }
                if (options.type) {
                    if ([ChannelTypes.GuildNews, ChannelTypes.GuildText].includes(options.type)) {
                        throw new Error("Only news and text types can be modified.");
                    }
                    if (guild && !guild.toggles.has("news")) {
                        throw new Error("The NEWS feature is missing in this guild to be able to modify the channel type.");
                    }
                }
                if (options.topic) {
                    if (!bot.utils.validateLength(options.topic, { min: 1, max: 1024 })) {
                        throw new Error("The topic must be a number between 1 and 1024");
                    }
                }
                if (options.userLimit && options.userLimit > 99) {
                    throw new Error("The user limit must be less than 99.");
                }
                if (options.parentId) {
                    const category = bot.channels.get(options.parentId);
                    if (category && category.type !== ChannelTypes.GuildCategory) {
                        throw new Error("The parent id must be for a category channel type.");
                    }
                }
            }
            requireBotChannelPermissions(bot, channel, requiredPerms);
        }
        return await editChannelOld(channelId, options, reason);
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZWRpdENoYW5uZWwuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJlZGl0Q2hhbm5lbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQWdCLFlBQVksRUFBaUIsTUFBTSxlQUFlLENBQUM7QUFDMUUsT0FBTyxFQUFFLDRCQUE0QixFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFFakUsTUFBTSxDQUFDLE9BQU8sVUFBVSxXQUFXLENBQUMsR0FBaUI7SUFDbkQsTUFBTSxjQUFjLEdBQUcsR0FBRyxDQUFDLE9BQU8sQ0FBQyxXQUFXLENBQUM7SUFFL0MsR0FBRyxDQUFDLE9BQU8sQ0FBQyxXQUFXLEdBQUcsS0FBSyxXQUFXLFNBQVMsRUFBRSxPQUFPLEVBQUUsTUFBTTtRQUNsRSxNQUFNLE9BQU8sR0FBRyxHQUFHLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUU1QyxJQUFJLE9BQU8sRUFBRSxPQUFPLEVBQUU7WUFDcEIsTUFBTSxLQUFLLEdBQUcsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBRTlDLElBQUksT0FBTyxDQUFDLGdCQUFnQixJQUFJLE9BQU8sQ0FBQyxnQkFBZ0IsR0FBRyxLQUFLLEVBQUU7Z0JBQ2hFLE1BQU0sSUFBSSxLQUFLLENBQ2IsNkZBQTZGLENBQzlGLENBQUM7YUFDSDtZQUVELElBQUksT0FBTyxDQUFDLElBQUksRUFBRTtnQkFDaEIsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsY0FBYyxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsRUFBRSxHQUFHLEVBQUUsQ0FBQyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsQ0FBQyxFQUFFO29CQUNqRSxNQUFNLElBQUksS0FBSyxDQUNiLG9EQUFvRCxDQUNyRCxDQUFDO2lCQUNIO2FBQ0Y7WUFFRCxNQUFNLFFBQVEsR0FBRztnQkFDZixZQUFZLENBQUMsZUFBZTtnQkFDNUIsWUFBWSxDQUFDLGlCQUFpQjtnQkFDOUIsWUFBWSxDQUFDLGtCQUFrQjthQUNoQyxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7WUFFekIsTUFBTSxhQUFhLEdBQXdCLEVBQUUsQ0FBQztZQUM5QyxJQUFJLFFBQVEsRUFBRTtnQkFDWixJQUNFLE9BQU8sQ0FBQyxTQUFTLEtBQUssU0FBUztvQkFDL0IsT0FBTyxDQUFDLElBQUksS0FBSyxZQUFZLENBQUMsa0JBQWtCLEVBQ2hEO29CQUNBLE1BQU0sSUFBSSxLQUFLLENBQ2Isc0RBQXNELENBQ3ZELENBQUM7aUJBQ0g7Z0JBR0QsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLElBQUksT0FBTyxDQUFDLFFBQVEsS0FBSyxLQUFLLEVBQUU7b0JBQ2pELGFBQWEsQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLENBQUM7b0JBRXBDLElBQUksTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO3dCQUNuQyxhQUFhLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLENBQUM7cUJBQ3RDO2lCQUNGO3FCQUFNO29CQUNMLGFBQWEsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztpQkFDdEM7YUFDRjtpQkFBTTtnQkFDTCxhQUFhLENBQUMsSUFBSSxDQUFDLGlCQUFpQixDQUFDLENBQUM7Z0JBRXRDLElBQUksT0FBTyxDQUFDLG9CQUFvQixFQUFFO29CQUNoQyxhQUFhLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDO2lCQUNwQztnQkFFRCxJQUFJLE9BQU8sQ0FBQyxJQUFJLEVBQUU7b0JBQ2hCLElBQ0UsQ0FBQyxZQUFZLENBQUMsU0FBUyxFQUFFLFlBQVksQ0FBQyxTQUFTLENBQUMsQ0FBQyxRQUFRLENBQ3ZELE9BQU8sQ0FBQyxJQUFJLENBQ2IsRUFDRDt3QkFDQSxNQUFNLElBQUksS0FBSyxDQUFDLDJDQUEyQyxDQUFDLENBQUM7cUJBQzlEO29CQUVELElBQUksS0FBSyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLEVBQUU7d0JBQ3ZDLE1BQU0sSUFBSSxLQUFLLENBQ2Isa0ZBQWtGLENBQ25GLENBQUM7cUJBQ0g7aUJBQ0Y7Z0JBRUQsSUFBSSxPQUFPLENBQUMsS0FBSyxFQUFFO29CQUNqQixJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxjQUFjLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxFQUFFLEdBQUcsRUFBRSxDQUFDLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxDQUFDLEVBQUU7d0JBQ25FLE1BQU0sSUFBSSxLQUFLLENBQUMsK0NBQStDLENBQUMsQ0FBQztxQkFDbEU7aUJBQ0Y7Z0JBRUQsSUFBSSxPQUFPLENBQUMsU0FBUyxJQUFJLE9BQU8sQ0FBQyxTQUFTLEdBQUcsRUFBRSxFQUFFO29CQUMvQyxNQUFNLElBQUksS0FBSyxDQUFDLHNDQUFzQyxDQUFDLENBQUM7aUJBQ3pEO2dCQUVELElBQUksT0FBTyxDQUFDLFFBQVEsRUFBRTtvQkFDcEIsTUFBTSxRQUFRLEdBQUcsR0FBRyxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDO29CQUNwRCxJQUFJLFFBQVEsSUFBSSxRQUFRLENBQUMsSUFBSSxLQUFLLFlBQVksQ0FBQyxhQUFhLEVBQUU7d0JBQzVELE1BQU0sSUFBSSxLQUFLLENBQ2Isb0RBQW9ELENBQ3JELENBQUM7cUJBQ0g7aUJBQ0Y7YUFDRjtZQUVELDRCQUE0QixDQUMxQixHQUFHLEVBQ0gsT0FBTyxFQUNQLGFBQWEsQ0FDZCxDQUFDO1NBQ0g7UUFFRCxPQUFPLE1BQU0sY0FBYyxDQUFDLFNBQVMsRUFBRSxPQUFPLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFDMUQsQ0FBQyxDQUFDO0FBQ0osQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFBlcm1pc3Npb25TdHJpbmdzIH0gZnJvbSBcIi4uLy4uL2RlcHMudHNcIjtcbmltcG9ydCB7IEJvdFdpdGhDYWNoZSwgQ2hhbm5lbFR5cGVzLCBHdWlsZEZlYXR1cmVzIH0gZnJvbSBcIi4uLy4uL2RlcHMudHNcIjtcbmltcG9ydCB7IHJlcXVpcmVCb3RDaGFubmVsUGVybWlzc2lvbnMgfSBmcm9tIFwiLi4vcGVybWlzc2lvbnMudHNcIjtcblxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gZWRpdENoYW5uZWwoYm90OiBCb3RXaXRoQ2FjaGUpIHtcbiAgY29uc3QgZWRpdENoYW5uZWxPbGQgPSBib3QuaGVscGVycy5lZGl0Q2hhbm5lbDtcblxuICBib3QuaGVscGVycy5lZGl0Q2hhbm5lbCA9IGFzeW5jIGZ1bmN0aW9uIChjaGFubmVsSWQsIG9wdGlvbnMsIHJlYXNvbikge1xuICAgIGNvbnN0IGNoYW5uZWwgPSBib3QuY2hhbm5lbHMuZ2V0KGNoYW5uZWxJZCk7XG5cbiAgICBpZiAoY2hhbm5lbD8uZ3VpbGRJZCkge1xuICAgICAgY29uc3QgZ3VpbGQgPSBib3QuZ3VpbGRzLmdldChjaGFubmVsLmd1aWxkSWQpO1xuXG4gICAgICBpZiAob3B0aW9ucy5yYXRlTGltaXRQZXJVc2VyICYmIG9wdGlvbnMucmF0ZUxpbWl0UGVyVXNlciA+IDIxNjAwKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICBcIkFtb3VudCBvZiBzZWNvbmRzIGEgdXNlciBoYXMgdG8gd2FpdCBiZWZvcmUgc2VuZGluZyBhbm90aGVyIG1lc3NhZ2UgbXVzdCBiZSBiZXR3ZWVuIDAtMjE2MDBcIixcbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgaWYgKG9wdGlvbnMubmFtZSkge1xuICAgICAgICBpZiAoIWJvdC51dGlscy52YWxpZGF0ZUxlbmd0aChvcHRpb25zLm5hbWUsIHsgbWluOiAxLCBtYXg6IDEwMCB9KSkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAgIFwiVGhlIGNoYW5uZWwgbmFtZSBtdXN0IGJlIGJldHdlZW4gMS0xMDAgY2hhcmFjdGVycy5cIixcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGlzVGhyZWFkID0gW1xuICAgICAgICBDaGFubmVsVHlwZXMuR3VpbGROZXdzVGhyZWFkLFxuICAgICAgICBDaGFubmVsVHlwZXMuR3VpbGRQdWJsaWNUaHJlYWQsXG4gICAgICAgIENoYW5uZWxUeXBlcy5HdWlsZFByaXZhdGVUaHJlYWQsXG4gICAgICBdLmluY2x1ZGVzKGNoYW5uZWwudHlwZSk7XG5cbiAgICAgIGNvbnN0IHJlcXVpcmVkUGVybXM6IFBlcm1pc3Npb25TdHJpbmdzW10gPSBbXTtcbiAgICAgIGlmIChpc1RocmVhZCkge1xuICAgICAgICBpZiAoXG4gICAgICAgICAgb3B0aW9ucy5pbnZpdGFibGUgIT09IHVuZGVmaW5lZCAmJlxuICAgICAgICAgIGNoYW5uZWwudHlwZSAhPT0gQ2hhbm5lbFR5cGVzLkd1aWxkUHJpdmF0ZVRocmVhZFxuICAgICAgICApIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgICBcIkludml0YWJsZSBvcHRpb24gaXMgb25seSBhbGxvd2VkIG9uIHByaXZhdGUgdGhyZWFkcy5cIixcbiAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gVU5BUkNISVZJTkcgQU4gVU5MT0NLRUQgQ0hBTk5FTCBTSU1QTFkgUkVRVUlSRVMgU0VORFxuICAgICAgICBpZiAoIWNoYW5uZWwubG9ja2VkICYmIG9wdGlvbnMuYXJjaGl2ZWQgPT09IGZhbHNlKSB7XG4gICAgICAgICAgcmVxdWlyZWRQZXJtcy5wdXNoKFwiU0VORF9NRVNTQUdFU1wiKTtcbiAgICAgICAgICAvLyBNT1JFIFRIQU4gQVJDSElWRSBXQVMgTU9ESUZJRURcbiAgICAgICAgICBpZiAoT2JqZWN0LmtleXMob3B0aW9ucykubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgcmVxdWlyZWRQZXJtcy5wdXNoKFwiTUFOQUdFX1RIUkVBRFNcIik7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlcXVpcmVkUGVybXMucHVzaChcIk1BTkFHRV9USFJFQURTXCIpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXF1aXJlZFBlcm1zLnB1c2goXCJNQU5BR0VfQ0hBTk5FTFNcIik7XG5cbiAgICAgICAgaWYgKG9wdGlvbnMucGVybWlzc2lvbk92ZXJ3cml0ZXMpIHtcbiAgICAgICAgICByZXF1aXJlZFBlcm1zLnB1c2goXCJNQU5BR0VfUk9MRVNcIik7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAob3B0aW9ucy50eXBlKSB7XG4gICAgICAgICAgaWYgKFxuICAgICAgICAgICAgW0NoYW5uZWxUeXBlcy5HdWlsZE5ld3MsIENoYW5uZWxUeXBlcy5HdWlsZFRleHRdLmluY2x1ZGVzKFxuICAgICAgICAgICAgICBvcHRpb25zLnR5cGUsXG4gICAgICAgICAgICApXG4gICAgICAgICAgKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJPbmx5IG5ld3MgYW5kIHRleHQgdHlwZXMgY2FuIGJlIG1vZGlmaWVkLlwiKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZiAoZ3VpbGQgJiYgIWd1aWxkLnRvZ2dsZXMuaGFzKFwibmV3c1wiKSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICAgICBcIlRoZSBORVdTIGZlYXR1cmUgaXMgbWlzc2luZyBpbiB0aGlzIGd1aWxkIHRvIGJlIGFibGUgdG8gbW9kaWZ5IHRoZSBjaGFubmVsIHR5cGUuXCIsXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChvcHRpb25zLnRvcGljKSB7XG4gICAgICAgICAgaWYgKCFib3QudXRpbHMudmFsaWRhdGVMZW5ndGgob3B0aW9ucy50b3BpYywgeyBtaW46IDEsIG1heDogMTAyNCB9KSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVGhlIHRvcGljIG11c3QgYmUgYSBudW1iZXIgYmV0d2VlbiAxIGFuZCAxMDI0XCIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChvcHRpb25zLnVzZXJMaW1pdCAmJiBvcHRpb25zLnVzZXJMaW1pdCA+IDk5KSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVGhlIHVzZXIgbGltaXQgbXVzdCBiZSBsZXNzIHRoYW4gOTkuXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG9wdGlvbnMucGFyZW50SWQpIHtcbiAgICAgICAgICBjb25zdCBjYXRlZ29yeSA9IGJvdC5jaGFubmVscy5nZXQob3B0aW9ucy5wYXJlbnRJZCk7XG4gICAgICAgICAgaWYgKGNhdGVnb3J5ICYmIGNhdGVnb3J5LnR5cGUgIT09IENoYW5uZWxUeXBlcy5HdWlsZENhdGVnb3J5KSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgICAgIFwiVGhlIHBhcmVudCBpZCBtdXN0IGJlIGZvciBhIGNhdGVnb3J5IGNoYW5uZWwgdHlwZS5cIixcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJlcXVpcmVCb3RDaGFubmVsUGVybWlzc2lvbnMoXG4gICAgICAgIGJvdCxcbiAgICAgICAgY2hhbm5lbCxcbiAgICAgICAgcmVxdWlyZWRQZXJtcyxcbiAgICAgICk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGF3YWl0IGVkaXRDaGFubmVsT2xkKGNoYW5uZWxJZCwgb3B0aW9ucywgcmVhc29uKTtcbiAgfTtcbn1cbiJdfQ==