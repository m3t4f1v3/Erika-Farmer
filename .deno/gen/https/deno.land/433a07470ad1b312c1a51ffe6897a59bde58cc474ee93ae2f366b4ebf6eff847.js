export async function editChannel(bot, channelId, options, reason) {
    if (options.name || options.topic) {
        const request = editChannelNameTopicQueue.get(channelId);
        if (!request) {
            editChannelNameTopicQueue.set(channelId, {
                channelId: channelId,
                amount: 1,
                timestamp: Date.now() + 600000,
                items: [],
            });
        }
        else if (request.amount === 1) {
            request.amount = 2;
            request.timestamp = Date.now() + 600000;
        }
        else {
            return new Promise((resolve, reject) => {
                request.items.push({ channelId, options, resolve, reject });
                if (editChannelProcessing)
                    return;
                editChannelProcessing = true;
                processEditChannelQueue(bot);
            });
        }
    }
    const result = await bot.rest.runMethod(bot.rest, "PATCH", bot.constants.routes.CHANNEL(channelId), {
        name: options.name,
        topic: options.topic,
        bitrate: options.bitrate,
        user_limit: options.userLimit,
        rate_limit_per_user: options.rateLimitPerUser,
        position: options.position,
        parent_id: options.parentId === null ? null : options.parentId?.toString(),
        nsfw: options.nsfw,
        type: options.type,
        archived: options.archived,
        auto_archive_duration: options.autoArchiveDuration,
        locked: options.locked,
        invitable: options.invitable,
        permission_overwrites: options.permissionOverwrites
            ? options.permissionOverwrites?.map((overwrite) => ({
                id: overwrite.id.toString(),
                type: overwrite.type,
                allow: overwrite.allow ? bot.utils.calculateBits(overwrite.allow) : null,
                deny: overwrite.deny ? bot.utils.calculateBits(overwrite.deny) : null,
            }))
            : undefined,
        reason,
    });
    return bot.transformers.channel(bot, { channel: result, guildId: bot.transformers.snowflake(result.guild_id) });
}
const editChannelNameTopicQueue = new Map();
let editChannelProcessing = false;
function processEditChannelQueue(bot) {
    if (!editChannelProcessing)
        return;
    const now = Date.now();
    editChannelNameTopicQueue.forEach(async (request) => {
        bot.events.debug(`Running forEach loop in edit_channel file.`);
        if (now < request.timestamp)
            return;
        if (!request.items.length) {
            return editChannelNameTopicQueue.delete(request.channelId);
        }
        request.amount = 0;
        const details = request.items.shift();
        if (!details)
            return;
        await bot.helpers
            .editChannel(details.channelId, details.options)
            .then((result) => details.resolve(result))
            .catch(details.reject);
        const secondDetails = request.items.shift();
        if (!secondDetails)
            return;
        await bot.helpers
            .editChannel(secondDetails.channelId, secondDetails.options)
            .then((result) => secondDetails.resolve(result))
            .catch(secondDetails.reject);
        return;
    });
    if (editChannelNameTopicQueue.size) {
        setTimeout(() => {
            bot.events.debug(`Running setTimeout in EDIT_CHANNEL file.`);
            processEditChannelQueue(bot);
        }, 60000);
    }
    else {
        editChannelProcessing = false;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZWRpdENoYW5uZWwuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJlZGl0Q2hhbm5lbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFPQSxNQUFNLENBQUMsS0FBSyxVQUFVLFdBQVcsQ0FBQyxHQUFRLEVBQUUsU0FBaUIsRUFBRSxPQUFzQixFQUFFLE1BQWU7SUFDcEcsSUFBSSxPQUFPLENBQUMsSUFBSSxJQUFJLE9BQU8sQ0FBQyxLQUFLLEVBQUU7UUFDakMsTUFBTSxPQUFPLEdBQUcseUJBQXlCLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ3pELElBQUksQ0FBQyxPQUFPLEVBQUU7WUFFWix5QkFBeUIsQ0FBQyxHQUFHLENBQUMsU0FBUyxFQUFFO2dCQUN2QyxTQUFTLEVBQUUsU0FBUztnQkFDcEIsTUFBTSxFQUFFLENBQUM7Z0JBRVQsU0FBUyxFQUFFLElBQUksQ0FBQyxHQUFHLEVBQUUsR0FBRyxNQUFNO2dCQUM5QixLQUFLLEVBQUUsRUFBRTthQUNWLENBQUMsQ0FBQztTQUNKO2FBQU0sSUFBSSxPQUFPLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRTtZQUUvQixPQUFPLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQztZQUNuQixPQUFPLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxHQUFHLEVBQUUsR0FBRyxNQUFNLENBQUM7U0FDekM7YUFBTTtZQUNMLE9BQU8sSUFBSSxPQUFPLENBQVUsQ0FBQyxPQUFPLEVBQUUsTUFBTSxFQUFFLEVBQUU7Z0JBRTlDLE9BQU8sQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEVBQUUsU0FBUyxFQUFFLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxFQUFFLENBQUMsQ0FBQztnQkFDNUQsSUFBSSxxQkFBcUI7b0JBQUUsT0FBTztnQkFDbEMscUJBQXFCLEdBQUcsSUFBSSxDQUFDO2dCQUM3Qix1QkFBdUIsQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUMvQixDQUFDLENBQUMsQ0FBQztTQUNKO0tBQ0Y7SUFFRCxNQUFNLE1BQU0sR0FBRyxNQUFNLEdBQUcsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUNyQyxHQUFHLENBQUMsSUFBSSxFQUNSLE9BQU8sRUFDUCxHQUFHLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLEVBQ3ZDO1FBQ0UsSUFBSSxFQUFFLE9BQU8sQ0FBQyxJQUFJO1FBQ2xCLEtBQUssRUFBRSxPQUFPLENBQUMsS0FBSztRQUNwQixPQUFPLEVBQUUsT0FBTyxDQUFDLE9BQU87UUFDeEIsVUFBVSxFQUFFLE9BQU8sQ0FBQyxTQUFTO1FBQzdCLG1CQUFtQixFQUFFLE9BQU8sQ0FBQyxnQkFBZ0I7UUFDN0MsUUFBUSxFQUFFLE9BQU8sQ0FBQyxRQUFRO1FBQzFCLFNBQVMsRUFBRSxPQUFPLENBQUMsUUFBUSxLQUFLLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsUUFBUSxFQUFFLFFBQVEsRUFBRTtRQUMxRSxJQUFJLEVBQUUsT0FBTyxDQUFDLElBQUk7UUFDbEIsSUFBSSxFQUFFLE9BQU8sQ0FBQyxJQUFJO1FBQ2xCLFFBQVEsRUFBRSxPQUFPLENBQUMsUUFBUTtRQUMxQixxQkFBcUIsRUFBRSxPQUFPLENBQUMsbUJBQW1CO1FBQ2xELE1BQU0sRUFBRSxPQUFPLENBQUMsTUFBTTtRQUN0QixTQUFTLEVBQUUsT0FBTyxDQUFDLFNBQVM7UUFDNUIscUJBQXFCLEVBQUUsT0FBTyxDQUFDLG9CQUFvQjtZQUNqRCxDQUFDLENBQUMsT0FBTyxDQUFDLG9CQUFvQixFQUFFLEdBQUcsQ0FBQyxDQUFDLFNBQVMsRUFBRSxFQUFFLENBQUMsQ0FBQztnQkFDbEQsRUFBRSxFQUFFLFNBQVMsQ0FBQyxFQUFFLENBQUMsUUFBUSxFQUFFO2dCQUMzQixJQUFJLEVBQUUsU0FBUyxDQUFDLElBQUk7Z0JBQ3BCLEtBQUssRUFBRSxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLGFBQWEsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUk7Z0JBQ3hFLElBQUksRUFBRSxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLGFBQWEsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUk7YUFDdEUsQ0FBQyxDQUFDO1lBQ0gsQ0FBQyxDQUFDLFNBQVM7UUFDYixNQUFNO0tBQ1AsQ0FDRixDQUFDO0lBRUYsT0FBTyxHQUFHLENBQUMsWUFBWSxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsRUFBRSxPQUFPLEVBQUUsTUFBTSxFQUFFLE9BQU8sRUFBRSxHQUFHLENBQUMsWUFBWSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsUUFBUyxDQUFDLEVBQUUsQ0FBQyxDQUFDO0FBQ25ILENBQUM7QUFlRCxNQUFNLHlCQUF5QixHQUFHLElBQUksR0FBRyxFQUE4QixDQUFDO0FBQ3hFLElBQUkscUJBQXFCLEdBQUcsS0FBSyxDQUFDO0FBRWxDLFNBQVMsdUJBQXVCLENBQUMsR0FBUTtJQUN2QyxJQUFJLENBQUMscUJBQXFCO1FBQUUsT0FBTztJQUVuQyxNQUFNLEdBQUcsR0FBRyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUM7SUFDdkIseUJBQXlCLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxPQUFPLEVBQUUsRUFBRTtRQUNsRCxHQUFHLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyw0Q0FBNEMsQ0FBQyxDQUFDO1FBQy9ELElBQUksR0FBRyxHQUFHLE9BQU8sQ0FBQyxTQUFTO1lBQUUsT0FBTztRQUVwQyxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxNQUFNLEVBQUU7WUFDekIsT0FBTyx5QkFBeUIsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1NBQzVEO1FBQ0QsT0FBTyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUM7UUFFbkIsTUFBTSxPQUFPLEdBQUcsT0FBTyxDQUFDLEtBQUssQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUV0QyxJQUFJLENBQUMsT0FBTztZQUFFLE9BQU87UUFFckIsTUFBTSxHQUFHLENBQUMsT0FBTzthQUNkLFdBQVcsQ0FBQyxPQUFPLENBQUMsU0FBUyxFQUFFLE9BQU8sQ0FBQyxPQUFPLENBQUM7YUFDL0MsSUFBSSxDQUFDLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDO2FBQ3pDLEtBQUssQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDekIsTUFBTSxhQUFhLEdBQUcsT0FBTyxDQUFDLEtBQUssQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUM1QyxJQUFJLENBQUMsYUFBYTtZQUFFLE9BQU87UUFFM0IsTUFBTSxHQUFHLENBQUMsT0FBTzthQUNkLFdBQVcsQ0FBQyxhQUFhLENBQUMsU0FBUyxFQUFFLGFBQWEsQ0FBQyxPQUFPLENBQUM7YUFDM0QsSUFBSSxDQUFDLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDO2FBQy9DLEtBQUssQ0FBQyxhQUFhLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDL0IsT0FBTztJQUNULENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBSSx5QkFBeUIsQ0FBQyxJQUFJLEVBQUU7UUFDbEMsVUFBVSxDQUFDLEdBQUcsRUFBRTtZQUNkLEdBQUcsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLDBDQUEwQyxDQUFDLENBQUM7WUFDN0QsdUJBQXVCLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDL0IsQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFDO0tBQ1g7U0FBTTtRQUNMLHFCQUFxQixHQUFHLEtBQUssQ0FBQztLQUMvQjtBQUNILENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdHlwZSB7IEJvdCB9IGZyb20gXCIuLi8uLi9ib3QudHNcIjtcbmltcG9ydCB7IENoYW5uZWwgfSBmcm9tIFwiLi4vLi4vdHJhbnNmb3JtZXJzL2NoYW5uZWwudHNcIjtcbmltcG9ydCB7IERpc2NvcmRDaGFubmVsIH0gZnJvbSBcIi4uLy4uL3R5cGVzL2Rpc2NvcmQudHNcIjtcbmltcG9ydCB7IENoYW5uZWxUeXBlcywgVmlkZW9RdWFsaXR5TW9kZXMgfSBmcm9tIFwiLi4vLi4vdHlwZXMvc2hhcmVkLnRzXCI7XG5pbXBvcnQgeyBPdmVyd3JpdGVSZWFkYWJsZSB9IGZyb20gXCIuL2VkaXRDaGFubmVsT3ZlcndyaXRlLnRzXCI7XG5cbi8qKiBVcGRhdGUgYSBjaGFubmVsJ3Mgc2V0dGluZ3MuIFJlcXVpcmVzIHRoZSBgTUFOQUdFX0NIQU5ORUxTYCBwZXJtaXNzaW9uIGZvciB0aGUgZ3VpbGQuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZWRpdENoYW5uZWwoYm90OiBCb3QsIGNoYW5uZWxJZDogYmlnaW50LCBvcHRpb25zOiBNb2RpZnlDaGFubmVsLCByZWFzb24/OiBzdHJpbmcpIHtcbiAgaWYgKG9wdGlvbnMubmFtZSB8fCBvcHRpb25zLnRvcGljKSB7XG4gICAgY29uc3QgcmVxdWVzdCA9IGVkaXRDaGFubmVsTmFtZVRvcGljUXVldWUuZ2V0KGNoYW5uZWxJZCk7XG4gICAgaWYgKCFyZXF1ZXN0KSB7XG4gICAgICAvLyBJZiB0aGlzIGhhc24ndCBiZWVuIGRvbmUgYmVmb3JlIHNpbXBseSBhZGQgMSBmb3IgaXRcbiAgICAgIGVkaXRDaGFubmVsTmFtZVRvcGljUXVldWUuc2V0KGNoYW5uZWxJZCwge1xuICAgICAgICBjaGFubmVsSWQ6IGNoYW5uZWxJZCxcbiAgICAgICAgYW1vdW50OiAxLFxuICAgICAgICAvLyAxMCBtaW51dGVzIGZyb20gbm93XG4gICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSArIDYwMDAwMCxcbiAgICAgICAgaXRlbXM6IFtdLFxuICAgICAgfSk7XG4gICAgfSBlbHNlIGlmIChyZXF1ZXN0LmFtb3VudCA9PT0gMSkge1xuICAgICAgLy8gU3RhcnQgcXVldWluZyBmdXR1cmUgcmVxdWVzdHMgdG8gdGhpcyBjaGFubmVsXG4gICAgICByZXF1ZXN0LmFtb3VudCA9IDI7XG4gICAgICByZXF1ZXN0LnRpbWVzdGFtcCA9IERhdGUubm93KCkgKyA2MDAwMDA7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBuZXcgUHJvbWlzZTxDaGFubmVsPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgIC8vIDIgaGF2ZSBhbHJlYWR5IGJlZW4gdXNlZCBhZGQgdG8gcXVldWVcbiAgICAgICAgcmVxdWVzdC5pdGVtcy5wdXNoKHsgY2hhbm5lbElkLCBvcHRpb25zLCByZXNvbHZlLCByZWplY3QgfSk7XG4gICAgICAgIGlmIChlZGl0Q2hhbm5lbFByb2Nlc3NpbmcpIHJldHVybjtcbiAgICAgICAgZWRpdENoYW5uZWxQcm9jZXNzaW5nID0gdHJ1ZTtcbiAgICAgICAgcHJvY2Vzc0VkaXRDaGFubmVsUXVldWUoYm90KTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGJvdC5yZXN0LnJ1bk1ldGhvZDxEaXNjb3JkQ2hhbm5lbD4oXG4gICAgYm90LnJlc3QsXG4gICAgXCJQQVRDSFwiLFxuICAgIGJvdC5jb25zdGFudHMucm91dGVzLkNIQU5ORUwoY2hhbm5lbElkKSxcbiAgICB7XG4gICAgICBuYW1lOiBvcHRpb25zLm5hbWUsXG4gICAgICB0b3BpYzogb3B0aW9ucy50b3BpYyxcbiAgICAgIGJpdHJhdGU6IG9wdGlvbnMuYml0cmF0ZSxcbiAgICAgIHVzZXJfbGltaXQ6IG9wdGlvbnMudXNlckxpbWl0LFxuICAgICAgcmF0ZV9saW1pdF9wZXJfdXNlcjogb3B0aW9ucy5yYXRlTGltaXRQZXJVc2VyLFxuICAgICAgcG9zaXRpb246IG9wdGlvbnMucG9zaXRpb24sXG4gICAgICBwYXJlbnRfaWQ6IG9wdGlvbnMucGFyZW50SWQgPT09IG51bGwgPyBudWxsIDogb3B0aW9ucy5wYXJlbnRJZD8udG9TdHJpbmcoKSxcbiAgICAgIG5zZnc6IG9wdGlvbnMubnNmdyxcbiAgICAgIHR5cGU6IG9wdGlvbnMudHlwZSxcbiAgICAgIGFyY2hpdmVkOiBvcHRpb25zLmFyY2hpdmVkLFxuICAgICAgYXV0b19hcmNoaXZlX2R1cmF0aW9uOiBvcHRpb25zLmF1dG9BcmNoaXZlRHVyYXRpb24sXG4gICAgICBsb2NrZWQ6IG9wdGlvbnMubG9ja2VkLFxuICAgICAgaW52aXRhYmxlOiBvcHRpb25zLmludml0YWJsZSxcbiAgICAgIHBlcm1pc3Npb25fb3ZlcndyaXRlczogb3B0aW9ucy5wZXJtaXNzaW9uT3ZlcndyaXRlc1xuICAgICAgICA/IG9wdGlvbnMucGVybWlzc2lvbk92ZXJ3cml0ZXM/Lm1hcCgob3ZlcndyaXRlKSA9PiAoe1xuICAgICAgICAgIGlkOiBvdmVyd3JpdGUuaWQudG9TdHJpbmcoKSxcbiAgICAgICAgICB0eXBlOiBvdmVyd3JpdGUudHlwZSxcbiAgICAgICAgICBhbGxvdzogb3ZlcndyaXRlLmFsbG93ID8gYm90LnV0aWxzLmNhbGN1bGF0ZUJpdHMob3ZlcndyaXRlLmFsbG93KSA6IG51bGwsXG4gICAgICAgICAgZGVueTogb3ZlcndyaXRlLmRlbnkgPyBib3QudXRpbHMuY2FsY3VsYXRlQml0cyhvdmVyd3JpdGUuZGVueSkgOiBudWxsLFxuICAgICAgICB9KSlcbiAgICAgICAgOiB1bmRlZmluZWQsXG4gICAgICByZWFzb24sXG4gICAgfSxcbiAgKTtcblxuICByZXR1cm4gYm90LnRyYW5zZm9ybWVycy5jaGFubmVsKGJvdCwgeyBjaGFubmVsOiByZXN1bHQsIGd1aWxkSWQ6IGJvdC50cmFuc2Zvcm1lcnMuc25vd2ZsYWtlKHJlc3VsdC5ndWlsZF9pZCEpIH0pO1xufVxuXG5pbnRlcmZhY2UgRWRpdENoYW5uZWxSZXF1ZXN0IHtcbiAgYW1vdW50OiBudW1iZXI7XG4gIHRpbWVzdGFtcDogbnVtYmVyO1xuICBjaGFubmVsSWQ6IGJpZ2ludDtcbiAgaXRlbXM6IHtcbiAgICBjaGFubmVsSWQ6IGJpZ2ludDtcbiAgICBvcHRpb25zOiBNb2RpZnlDaGFubmVsO1xuICAgIHJlc29sdmU6IChjaGFubmVsOiBDaGFubmVsKSA9PiB2b2lkO1xuICAgIC8vIGRlbm8tbGludC1pZ25vcmUgbm8tZXhwbGljaXQtYW55XG4gICAgcmVqZWN0OiAoZXJyb3I6IGFueSkgPT4gdm9pZDtcbiAgfVtdO1xufVxuXG5jb25zdCBlZGl0Q2hhbm5lbE5hbWVUb3BpY1F1ZXVlID0gbmV3IE1hcDxiaWdpbnQsIEVkaXRDaGFubmVsUmVxdWVzdD4oKTtcbmxldCBlZGl0Q2hhbm5lbFByb2Nlc3NpbmcgPSBmYWxzZTtcblxuZnVuY3Rpb24gcHJvY2Vzc0VkaXRDaGFubmVsUXVldWUoYm90OiBCb3QpIHtcbiAgaWYgKCFlZGl0Q2hhbm5lbFByb2Nlc3NpbmcpIHJldHVybjtcblxuICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xuICBlZGl0Q2hhbm5lbE5hbWVUb3BpY1F1ZXVlLmZvckVhY2goYXN5bmMgKHJlcXVlc3QpID0+IHtcbiAgICBib3QuZXZlbnRzLmRlYnVnKGBSdW5uaW5nIGZvckVhY2ggbG9vcCBpbiBlZGl0X2NoYW5uZWwgZmlsZS5gKTtcbiAgICBpZiAobm93IDwgcmVxdWVzdC50aW1lc3RhbXApIHJldHVybjtcbiAgICAvLyAxMCBtaW51dGVzIGhhdmUgcGFzc2VkIHNvIHdlIGNhbiByZXNldCB0aGlzIGNoYW5uZWwgYWdhaW5cbiAgICBpZiAoIXJlcXVlc3QuaXRlbXMubGVuZ3RoKSB7XG4gICAgICByZXR1cm4gZWRpdENoYW5uZWxOYW1lVG9waWNRdWV1ZS5kZWxldGUocmVxdWVzdC5jaGFubmVsSWQpO1xuICAgIH1cbiAgICByZXF1ZXN0LmFtb3VudCA9IDA7XG4gICAgLy8gVGhlcmUgYXJlIGl0ZW1zIHRvIHByb2Nlc3MgZm9yIHRoaXMgcmVxdWVzdFxuICAgIGNvbnN0IGRldGFpbHMgPSByZXF1ZXN0Lml0ZW1zLnNoaWZ0KCk7XG5cbiAgICBpZiAoIWRldGFpbHMpIHJldHVybjtcblxuICAgIGF3YWl0IGJvdC5oZWxwZXJzXG4gICAgICAuZWRpdENoYW5uZWwoZGV0YWlscy5jaGFubmVsSWQsIGRldGFpbHMub3B0aW9ucylcbiAgICAgIC50aGVuKChyZXN1bHQpID0+IGRldGFpbHMucmVzb2x2ZShyZXN1bHQpKVxuICAgICAgLmNhdGNoKGRldGFpbHMucmVqZWN0KTtcbiAgICBjb25zdCBzZWNvbmREZXRhaWxzID0gcmVxdWVzdC5pdGVtcy5zaGlmdCgpO1xuICAgIGlmICghc2Vjb25kRGV0YWlscykgcmV0dXJuO1xuXG4gICAgYXdhaXQgYm90LmhlbHBlcnNcbiAgICAgIC5lZGl0Q2hhbm5lbChzZWNvbmREZXRhaWxzLmNoYW5uZWxJZCwgc2Vjb25kRGV0YWlscy5vcHRpb25zKVxuICAgICAgLnRoZW4oKHJlc3VsdCkgPT4gc2Vjb25kRGV0YWlscy5yZXNvbHZlKHJlc3VsdCkpXG4gICAgICAuY2F0Y2goc2Vjb25kRGV0YWlscy5yZWplY3QpO1xuICAgIHJldHVybjtcbiAgfSk7XG5cbiAgaWYgKGVkaXRDaGFubmVsTmFtZVRvcGljUXVldWUuc2l6ZSkge1xuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgYm90LmV2ZW50cy5kZWJ1ZyhgUnVubmluZyBzZXRUaW1lb3V0IGluIEVESVRfQ0hBTk5FTCBmaWxlLmApO1xuICAgICAgcHJvY2Vzc0VkaXRDaGFubmVsUXVldWUoYm90KTtcbiAgICB9LCA2MDAwMCk7XG4gIH0gZWxzZSB7XG4gICAgZWRpdENoYW5uZWxQcm9jZXNzaW5nID0gZmFsc2U7XG4gIH1cbn1cblxuZXhwb3J0IGludGVyZmFjZSBNb2RpZnlDaGFubmVsIHtcbiAgLyoqIDEtMTAwIGNoYXJhY3RlciBjaGFubmVsIG5hbWUgKi9cbiAgbmFtZT86IHN0cmluZztcbiAgLyoqIFRoZSB0eXBlIG9mIGNoYW5uZWw7IG9ubHkgY29udmVyc2lvbiBiZXR3ZWVuIHRleHQgYW5kIG5ld3MgaXMgc3VwcG9ydGVkIGFuZCBvbmx5IGluIGd1aWxkcyB3aXRoIHRoZSBcIk5FV1NcIiBmZWF0dXJlICovXG4gIHR5cGU/OiBDaGFubmVsVHlwZXM7XG4gIC8qKiBUaGUgcG9zaXRpb24gb2YgdGhlIGNoYW5uZWwgaW4gdGhlIGxlZnQtaGFuZCBsaXN0aW5nICovXG4gIHBvc2l0aW9uPzogbnVtYmVyIHwgbnVsbDtcbiAgLyoqIDAtMTAyNCBjaGFyYWN0ZXIgY2hhbm5lbCB0b3BpYyAqL1xuICB0b3BpYz86IHN0cmluZyB8IG51bGw7XG4gIC8qKiBXaGV0aGVyIHRoZSBjaGFubmVsIGlzIG5zZncgKi9cbiAgbnNmdz86IGJvb2xlYW4gfCBudWxsO1xuICAvKiogQW1vdW50IG9mIHNlY29uZHMgYSB1c2VyIGhhcyB0byB3YWl0IGJlZm9yZSBzZW5kaW5nIGFub3RoZXIgbWVzc2FnZSAoMC0yMTYwMCk7IGJvdHMsIGFzIHdlbGwgYXMgdXNlcnMgd2l0aCB0aGUgcGVybWlzc2lvbiBgbWFuYWdlX21lc3NhZ2VzYCBvciBgbWFuYWdlX2NoYW5uZWxgLCBhcmUgdW5hZmZlY3RlZCAqL1xuICByYXRlTGltaXRQZXJVc2VyPzogbnVtYmVyIHwgbnVsbDtcbiAgLyoqIFRoZSBiaXRyYXRlIChpbiBiaXRzKSBvZiB0aGUgdm9pY2UgY2hhbm5lbDsgODAwMCB0byA5NjAwMCAoMTI4MDAwIGZvciBWSVAgc2VydmVycykgKi9cbiAgYml0cmF0ZT86IG51bWJlciB8IG51bGw7XG4gIC8qKiBUaGUgdXNlciBsaW1pdCBvZiB0aGUgdm9pY2UgY2hhbm5lbDsgMCByZWZlcnMgdG8gbm8gbGltaXQsIDEgdG8gOTkgcmVmZXJzIHRvIGEgdXNlciBsaW1pdCAqL1xuICB1c2VyTGltaXQ/OiBudW1iZXIgfCBudWxsO1xuICAvKiogQ2hhbm5lbCBvciBjYXRlZ29yeS1zcGVjaWZpYyBwZXJtaXNzaW9ucyAqL1xuICBwZXJtaXNzaW9uT3ZlcndyaXRlcz86IE92ZXJ3cml0ZVJlYWRhYmxlW10gfCBudWxsO1xuICAvKiogSWQgb2YgdGhlIG5ldyBwYXJlbnQgY2F0ZWdvcnkgZm9yIGEgY2hhbm5lbCAqL1xuICBwYXJlbnRJZD86IGJpZ2ludCB8IG51bGw7XG4gIC8qKiBWb2ljZSByZWdpb24gaWQgZm9yIHRoZSB2b2ljZSBjaGFubmVsLCBhdXRvbWF0aWMgd2hlbiBzZXQgdG8gbnVsbCAqL1xuICBydGNSZWdpb24/OiBzdHJpbmcgfCBudWxsO1xuICAvKiogVGhlIGNhbWVyYSB2aWRlbyBxdWFsaXR5IG1vZGUgb2YgdGhlIHZvaWNlIGNoYW5uZWwgKi9cbiAgdmlkZW9RdWFsaXR5TW9kZT86IFZpZGVvUXVhbGl0eU1vZGVzO1xuICAvKiogV2hldGhlciB0aGUgdGhyZWFkIGlzIGFyY2hpdmVkICovXG4gIGFyY2hpdmVkPzogYm9vbGVhbjtcbiAgLyoqIER1cmF0aW9uIGluIG1pbnV0ZXMgdG8gYXV0b21hdGljYWxseSBhcmNoaXZlIHRoZSB0aHJlYWQgYWZ0ZXIgcmVjZW50IGFjdGl2aXR5ICovXG4gIGF1dG9BcmNoaXZlRHVyYXRpb24/OiA2MCB8IDE0NDAgfCA0MzIwIHwgMTAwODA7XG4gIC8qKiBXaGVuIGEgdGhyZWFkIGlzIGxvY2tlZCwgb25seSB1c2VycyB3aXRoIGBNQU5BR0VfVEhSRUFEU2AgY2FuIHVuYXJjaGl2ZSBpdCAqL1xuICBsb2NrZWQ/OiBib29sZWFuO1xuICAvKiogd2hldGhlciBub24tbW9kZXJhdG9ycyBjYW4gYWRkIG90aGVyIG5vbi1tb2RlcmF0b3JzIHRvIGEgdGhyZWFkOyBvbmx5IGF2YWlsYWJsZSBvbiBwcml2YXRlIHRocmVhZHMgKi9cbiAgaW52aXRhYmxlPzogYm9vbGVhbjtcbn1cbiJdfQ==