import { requireBotChannelPermissions } from "../permissions.ts";
export function createStageInstance(bot) {
    const createStageInstanceOld = bot.helpers.createStageInstance;
    bot.helpers.createStageInstance = async function (options) {
        if (!bot.utils.validateLength(options.topic, { max: 120, min: 1 })) {
            throw new Error("The topic length for creating a stage instance must be between 1-120.");
        }
        const perms = new Set([
            "MANAGE_CHANNELS",
            "MUTE_MEMBERS",
            "MOVE_MEMBERS",
        ]);
        if (options.sendStartNotification) {
            perms.add("MENTION_EVERYONE");
        }
        requireBotChannelPermissions(bot, options.channelId, [...perms.values()]);
        return await createStageInstanceOld(options);
    };
}
export function deleteStageInstance(bot) {
    const deleteStageInstanceOld = bot.helpers.deleteStageInstance;
    bot.helpers.deleteStageInstance = async function (channelId) {
        requireBotChannelPermissions(bot, channelId, [
            "MANAGE_CHANNELS",
            "MUTE_MEMBERS",
            "MOVE_MEMBERS",
        ]);
        return await deleteStageInstanceOld(channelId);
    };
}
export function updateStageInstance(bot) {
    const updateStageInstanceOld = bot.helpers.updateStageInstance;
    bot.helpers.updateStageInstance = async function (channelId, data) {
        requireBotChannelPermissions(bot, channelId, [
            "MANAGE_CHANNELS",
            "MUTE_MEMBERS",
            "MOVE_MEMBERS",
        ]);
        return await updateStageInstanceOld(channelId, data);
    };
}
export default function setupStagePermChecks(bot) {
    createStageInstance(bot);
    deleteStageInstance(bot);
    updateStageInstance(bot);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RhZ2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJzdGFnZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQUUsNEJBQTRCLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUVqRSxNQUFNLFVBQVUsbUJBQW1CLENBQUMsR0FBaUI7SUFDbkQsTUFBTSxzQkFBc0IsR0FBRyxHQUFHLENBQUMsT0FBTyxDQUFDLG1CQUFtQixDQUFDO0lBRS9ELEdBQUcsQ0FBQyxPQUFPLENBQUMsbUJBQW1CLEdBQUcsS0FBSyxXQUFXLE9BQU87UUFDdkQsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsY0FBYyxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFO1lBQ2xFLE1BQU0sSUFBSSxLQUFLLENBQ2IsdUVBQXVFLENBQ3hFLENBQUM7U0FDSDtRQUVELE1BQU0sS0FBSyxHQUFHLElBQUksR0FBRyxDQUFvQjtZQUN2QyxpQkFBaUI7WUFDakIsY0FBYztZQUNkLGNBQWM7U0FDZixDQUFDLENBQUM7UUFFSCxJQUFJLE9BQU8sQ0FBQyxxQkFBcUIsRUFBRTtZQUNqQyxLQUFLLENBQUMsR0FBRyxDQUFDLGtCQUFrQixDQUFDLENBQUM7U0FDL0I7UUFFRCw0QkFBNEIsQ0FBQyxHQUFHLEVBQUUsT0FBTyxDQUFDLFNBQVMsRUFBRSxDQUFDLEdBQUcsS0FBSyxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUMsQ0FBQztRQUUxRSxPQUFPLE1BQU0sc0JBQXNCLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDL0MsQ0FBQyxDQUFDO0FBQ0osQ0FBQztBQUVELE1BQU0sVUFBVSxtQkFBbUIsQ0FBQyxHQUFpQjtJQUNuRCxNQUFNLHNCQUFzQixHQUFHLEdBQUcsQ0FBQyxPQUFPLENBQUMsbUJBQW1CLENBQUM7SUFFL0QsR0FBRyxDQUFDLE9BQU8sQ0FBQyxtQkFBbUIsR0FBRyxLQUFLLFdBQVcsU0FBUztRQUN6RCw0QkFBNEIsQ0FBQyxHQUFHLEVBQUUsU0FBUyxFQUFFO1lBQzNDLGlCQUFpQjtZQUNqQixjQUFjO1lBQ2QsY0FBYztTQUNmLENBQUMsQ0FBQztRQUVILE9BQU8sTUFBTSxzQkFBc0IsQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUNqRCxDQUFDLENBQUM7QUFDSixDQUFDO0FBRUQsTUFBTSxVQUFVLG1CQUFtQixDQUFDLEdBQWlCO0lBQ25ELE1BQU0sc0JBQXNCLEdBQUcsR0FBRyxDQUFDLE9BQU8sQ0FBQyxtQkFBbUIsQ0FBQztJQUUvRCxHQUFHLENBQUMsT0FBTyxDQUFDLG1CQUFtQixHQUFHLEtBQUssV0FBVyxTQUFTLEVBQUUsSUFBSTtRQUMvRCw0QkFBNEIsQ0FBQyxHQUFHLEVBQUUsU0FBUyxFQUFFO1lBQzNDLGlCQUFpQjtZQUNqQixjQUFjO1lBQ2QsY0FBYztTQUNmLENBQUMsQ0FBQztRQUVILE9BQU8sTUFBTSxzQkFBc0IsQ0FBQyxTQUFTLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDdkQsQ0FBQyxDQUFDO0FBQ0osQ0FBQztBQUVELE1BQU0sQ0FBQyxPQUFPLFVBQVUsb0JBQW9CLENBQUMsR0FBaUI7SUFDNUQsbUJBQW1CLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDekIsbUJBQW1CLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDekIsbUJBQW1CLENBQUMsR0FBRyxDQUFDLENBQUM7QUFDM0IsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEJvdFdpdGhDYWNoZSwgUGVybWlzc2lvblN0cmluZ3MgfSBmcm9tIFwiLi4vLi4vZGVwcy50c1wiO1xuaW1wb3J0IHsgcmVxdWlyZUJvdENoYW5uZWxQZXJtaXNzaW9ucyB9IGZyb20gXCIuLi9wZXJtaXNzaW9ucy50c1wiO1xuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlU3RhZ2VJbnN0YW5jZShib3Q6IEJvdFdpdGhDYWNoZSkge1xuICBjb25zdCBjcmVhdGVTdGFnZUluc3RhbmNlT2xkID0gYm90LmhlbHBlcnMuY3JlYXRlU3RhZ2VJbnN0YW5jZTtcblxuICBib3QuaGVscGVycy5jcmVhdGVTdGFnZUluc3RhbmNlID0gYXN5bmMgZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICBpZiAoIWJvdC51dGlscy52YWxpZGF0ZUxlbmd0aChvcHRpb25zLnRvcGljLCB7IG1heDogMTIwLCBtaW46IDEgfSkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgXCJUaGUgdG9waWMgbGVuZ3RoIGZvciBjcmVhdGluZyBhIHN0YWdlIGluc3RhbmNlIG11c3QgYmUgYmV0d2VlbiAxLTEyMC5cIixcbiAgICAgICk7XG4gICAgfVxuXG4gICAgY29uc3QgcGVybXMgPSBuZXcgU2V0PFBlcm1pc3Npb25TdHJpbmdzPihbXG4gICAgICBcIk1BTkFHRV9DSEFOTkVMU1wiLFxuICAgICAgXCJNVVRFX01FTUJFUlNcIixcbiAgICAgIFwiTU9WRV9NRU1CRVJTXCIsXG4gICAgXSk7XG5cbiAgICBpZiAob3B0aW9ucy5zZW5kU3RhcnROb3RpZmljYXRpb24pIHtcbiAgICAgIHBlcm1zLmFkZChcIk1FTlRJT05fRVZFUllPTkVcIik7XG4gICAgfVxuXG4gICAgcmVxdWlyZUJvdENoYW5uZWxQZXJtaXNzaW9ucyhib3QsIG9wdGlvbnMuY2hhbm5lbElkLCBbLi4ucGVybXMudmFsdWVzKCldKTtcblxuICAgIHJldHVybiBhd2FpdCBjcmVhdGVTdGFnZUluc3RhbmNlT2xkKG9wdGlvbnMpO1xuICB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZGVsZXRlU3RhZ2VJbnN0YW5jZShib3Q6IEJvdFdpdGhDYWNoZSkge1xuICBjb25zdCBkZWxldGVTdGFnZUluc3RhbmNlT2xkID0gYm90LmhlbHBlcnMuZGVsZXRlU3RhZ2VJbnN0YW5jZTtcblxuICBib3QuaGVscGVycy5kZWxldGVTdGFnZUluc3RhbmNlID0gYXN5bmMgZnVuY3Rpb24gKGNoYW5uZWxJZCkge1xuICAgIHJlcXVpcmVCb3RDaGFubmVsUGVybWlzc2lvbnMoYm90LCBjaGFubmVsSWQsIFtcbiAgICAgIFwiTUFOQUdFX0NIQU5ORUxTXCIsXG4gICAgICBcIk1VVEVfTUVNQkVSU1wiLFxuICAgICAgXCJNT1ZFX01FTUJFUlNcIixcbiAgICBdKTtcblxuICAgIHJldHVybiBhd2FpdCBkZWxldGVTdGFnZUluc3RhbmNlT2xkKGNoYW5uZWxJZCk7XG4gIH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB1cGRhdGVTdGFnZUluc3RhbmNlKGJvdDogQm90V2l0aENhY2hlKSB7XG4gIGNvbnN0IHVwZGF0ZVN0YWdlSW5zdGFuY2VPbGQgPSBib3QuaGVscGVycy51cGRhdGVTdGFnZUluc3RhbmNlO1xuXG4gIGJvdC5oZWxwZXJzLnVwZGF0ZVN0YWdlSW5zdGFuY2UgPSBhc3luYyBmdW5jdGlvbiAoY2hhbm5lbElkLCBkYXRhKSB7XG4gICAgcmVxdWlyZUJvdENoYW5uZWxQZXJtaXNzaW9ucyhib3QsIGNoYW5uZWxJZCwgW1xuICAgICAgXCJNQU5BR0VfQ0hBTk5FTFNcIixcbiAgICAgIFwiTVVURV9NRU1CRVJTXCIsXG4gICAgICBcIk1PVkVfTUVNQkVSU1wiLFxuICAgIF0pO1xuXG4gICAgcmV0dXJuIGF3YWl0IHVwZGF0ZVN0YWdlSW5zdGFuY2VPbGQoY2hhbm5lbElkLCBkYXRhKTtcbiAgfTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gc2V0dXBTdGFnZVBlcm1DaGVja3MoYm90OiBCb3RXaXRoQ2FjaGUpIHtcbiAgY3JlYXRlU3RhZ2VJbnN0YW5jZShib3QpO1xuICBkZWxldGVTdGFnZUluc3RhbmNlKGJvdCk7XG4gIHVwZGF0ZVN0YWdlSW5zdGFuY2UoYm90KTtcbn1cbiJdfQ==