import { AllowedMentionsTypes } from "../../deps.ts";
export default function editFollowupMessage(bot) {
    const editFollowupMessageOld = bot.helpers.editFollowupMessage;
    bot.helpers.editFollowupMessage = async function(token, messageId, options) {
        if (options.content && options.content.length > 2000) {
            throw Error("MESSAGE_MAX_LENGTH");
        }
        if (options.embeds && options.embeds.length > 10) {
            options.embeds.splice(10);
        }
        if (options.allowedMentions) {
            if (options.allowedMentions.users?.length) {
                if (options.allowedMentions.parse?.includes(AllowedMentionsTypes.UserMentions)) {
                    options.allowedMentions.parse = options.allowedMentions.parse.filter((p)=>p !== "users"
                    );
                }
                if (options.allowedMentions.users.length > 100) {
                    options.allowedMentions.users = options.allowedMentions.users.slice(0, 100);
                }
            }
            if (options.allowedMentions.roles?.length) {
                if (options.allowedMentions.parse?.includes(AllowedMentionsTypes.RoleMentions)) {
                    options.allowedMentions.parse = options.allowedMentions.parse.filter((p)=>p !== "roles"
                    );
                }
                if (options.allowedMentions.roles.length > 100) {
                    options.allowedMentions.roles = options.allowedMentions.roles.slice(0, 100);
                }
            }
        }
        return await editFollowupMessageOld(token, messageId, options);
    };
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBbGxvd2VkTWVudGlvbnNUeXBlcywgQm90V2l0aENhY2hlIH0gZnJvbSBcIi4uLy4uL2RlcHMudHNcIjtcblxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gZWRpdEZvbGxvd3VwTWVzc2FnZShib3Q6IEJvdFdpdGhDYWNoZSkge1xuICBjb25zdCBlZGl0Rm9sbG93dXBNZXNzYWdlT2xkID0gYm90LmhlbHBlcnMuZWRpdEZvbGxvd3VwTWVzc2FnZTtcblxuICBib3QuaGVscGVycy5lZGl0Rm9sbG93dXBNZXNzYWdlID0gYXN5bmMgZnVuY3Rpb24gKFxuICAgIHRva2VuLFxuICAgIG1lc3NhZ2VJZCxcbiAgICBvcHRpb25zLFxuICApIHtcbiAgICBpZiAob3B0aW9ucy5jb250ZW50ICYmIG9wdGlvbnMuY29udGVudC5sZW5ndGggPiAyMDAwKSB7XG4gICAgICB0aHJvdyBFcnJvcihcIk1FU1NBR0VfTUFYX0xFTkdUSFwiKTtcbiAgICB9XG5cbiAgICBpZiAob3B0aW9ucy5lbWJlZHMgJiYgb3B0aW9ucy5lbWJlZHMubGVuZ3RoID4gMTApIHtcbiAgICAgIG9wdGlvbnMuZW1iZWRzLnNwbGljZSgxMCk7XG4gICAgfVxuXG4gICAgaWYgKG9wdGlvbnMuYWxsb3dlZE1lbnRpb25zKSB7XG4gICAgICBpZiAob3B0aW9ucy5hbGxvd2VkTWVudGlvbnMudXNlcnM/Lmxlbmd0aCkge1xuICAgICAgICBpZiAoXG4gICAgICAgICAgb3B0aW9ucy5hbGxvd2VkTWVudGlvbnMucGFyc2U/LmluY2x1ZGVzKFxuICAgICAgICAgICAgQWxsb3dlZE1lbnRpb25zVHlwZXMuVXNlck1lbnRpb25zLFxuICAgICAgICAgIClcbiAgICAgICAgKSB7XG4gICAgICAgICAgb3B0aW9ucy5hbGxvd2VkTWVudGlvbnMucGFyc2UgPSBvcHRpb25zLmFsbG93ZWRNZW50aW9ucy5wYXJzZS5maWx0ZXIoKFxuICAgICAgICAgICAgcCxcbiAgICAgICAgICApID0+IHAgIT09IFwidXNlcnNcIik7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAob3B0aW9ucy5hbGxvd2VkTWVudGlvbnMudXNlcnMubGVuZ3RoID4gMTAwKSB7XG4gICAgICAgICAgb3B0aW9ucy5hbGxvd2VkTWVudGlvbnMudXNlcnMgPSBvcHRpb25zLmFsbG93ZWRNZW50aW9ucy51c2Vycy5zbGljZShcbiAgICAgICAgICAgIDAsXG4gICAgICAgICAgICAxMDAsXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAob3B0aW9ucy5hbGxvd2VkTWVudGlvbnMucm9sZXM/Lmxlbmd0aCkge1xuICAgICAgICBpZiAoXG4gICAgICAgICAgb3B0aW9ucy5hbGxvd2VkTWVudGlvbnMucGFyc2U/LmluY2x1ZGVzKFxuICAgICAgICAgICAgQWxsb3dlZE1lbnRpb25zVHlwZXMuUm9sZU1lbnRpb25zLFxuICAgICAgICAgIClcbiAgICAgICAgKSB7XG4gICAgICAgICAgb3B0aW9ucy5hbGxvd2VkTWVudGlvbnMucGFyc2UgPSBvcHRpb25zLmFsbG93ZWRNZW50aW9ucy5wYXJzZS5maWx0ZXIoKFxuICAgICAgICAgICAgcCxcbiAgICAgICAgICApID0+IHAgIT09IFwicm9sZXNcIik7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAob3B0aW9ucy5hbGxvd2VkTWVudGlvbnMucm9sZXMubGVuZ3RoID4gMTAwKSB7XG4gICAgICAgICAgb3B0aW9ucy5hbGxvd2VkTWVudGlvbnMucm9sZXMgPSBvcHRpb25zLmFsbG93ZWRNZW50aW9ucy5yb2xlcy5zbGljZShcbiAgICAgICAgICAgIDAsXG4gICAgICAgICAgICAxMDAsXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBhd2FpdCBlZGl0Rm9sbG93dXBNZXNzYWdlT2xkKHRva2VuLCBtZXNzYWdlSWQsIG9wdGlvbnMpO1xuICB9O1xufVxuIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJTQUFTLG9CQUFvQixRQUFzQixlQUFlLENBQUM7QUFFbkUsZUFBZSxTQUFTLG1CQUFtQixDQUFDLEdBQWlCLEVBQUU7SUFDN0QsTUFBTSxzQkFBc0IsR0FBRyxHQUFHLENBQUMsT0FBTyxDQUFDLG1CQUFtQixBQUFDO0lBRS9ELEdBQUcsQ0FBQyxPQUFPLENBQUMsbUJBQW1CLEdBQUcsZUFDaEMsS0FBSyxFQUNMLFNBQVMsRUFDVCxPQUFPLEVBQ1A7UUFDQSxJQUFJLE9BQU8sQ0FBQyxPQUFPLElBQUksT0FBTyxDQUFDLE9BQU8sQ0FBQyxNQUFNLEdBQUcsSUFBSSxFQUFFO1lBQ3BELE1BQU0sS0FBSyxDQUFDLG9CQUFvQixDQUFDLENBQUM7U0FDbkM7UUFFRCxJQUFJLE9BQU8sQ0FBQyxNQUFNLElBQUksT0FBTyxDQUFDLE1BQU0sQ0FBQyxNQUFNLEdBQUcsRUFBRSxFQUFFO1lBQ2hELE9BQU8sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1NBQzNCO1FBRUQsSUFBSSxPQUFPLENBQUMsZUFBZSxFQUFFO1lBQzNCLElBQUksT0FBTyxDQUFDLGVBQWUsQ0FBQyxLQUFLLEVBQUUsTUFBTSxFQUFFO2dCQUN6QyxJQUNFLE9BQU8sQ0FBQyxlQUFlLENBQUMsS0FBSyxFQUFFLFFBQVEsQ0FDckMsb0JBQW9CLENBQUMsWUFBWSxDQUNsQyxFQUNEO29CQUNBLE9BQU8sQ0FBQyxlQUFlLENBQUMsS0FBSyxHQUFHLE9BQU8sQ0FBQyxlQUFlLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUNuRSxDQUFDLEdBQ0UsQ0FBQyxLQUFLLE9BQU87b0JBQUEsQ0FBQyxDQUFDO2lCQUNyQjtnQkFFRCxJQUFJLE9BQU8sQ0FBQyxlQUFlLENBQUMsS0FBSyxDQUFDLE1BQU0sR0FBRyxHQUFHLEVBQUU7b0JBQzlDLE9BQU8sQ0FBQyxlQUFlLENBQUMsS0FBSyxHQUFHLE9BQU8sQ0FBQyxlQUFlLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FDakUsQ0FBQyxFQUNELEdBQUcsQ0FDSixDQUFDO2lCQUNIO2FBQ0Y7WUFFRCxJQUFJLE9BQU8sQ0FBQyxlQUFlLENBQUMsS0FBSyxFQUFFLE1BQU0sRUFBRTtnQkFDekMsSUFDRSxPQUFPLENBQUMsZUFBZSxDQUFDLEtBQUssRUFBRSxRQUFRLENBQ3JDLG9CQUFvQixDQUFDLFlBQVksQ0FDbEMsRUFDRDtvQkFDQSxPQUFPLENBQUMsZUFBZSxDQUFDLEtBQUssR0FBRyxPQUFPLENBQUMsZUFBZSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FDbkUsQ0FBQyxHQUNFLENBQUMsS0FBSyxPQUFPO29CQUFBLENBQUMsQ0FBQztpQkFDckI7Z0JBRUQsSUFBSSxPQUFPLENBQUMsZUFBZSxDQUFDLEtBQUssQ0FBQyxNQUFNLEdBQUcsR0FBRyxFQUFFO29CQUM5QyxPQUFPLENBQUMsZUFBZSxDQUFDLEtBQUssR0FBRyxPQUFPLENBQUMsZUFBZSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQ2pFLENBQUMsRUFDRCxHQUFHLENBQ0osQ0FBQztpQkFDSDthQUNGO1NBQ0Y7UUFFRCxPQUFPLE1BQU0sc0JBQXNCLENBQUMsS0FBSyxFQUFFLFNBQVMsRUFBRSxPQUFPLENBQUMsQ0FBQztLQUNoRSxDQUFDO0NBQ0gsQ0FBQSJ9