import { CHANNEL_MENTION_REGEX } from "../util/constants.ts";
import { MemberToggles } from "./toggles/member.ts";
export function transformMessage(bot, payload) {
    const guildId = payload.guild_id ? bot.transformers.snowflake(payload.guild_id) : undefined;
    const userId = bot.transformers.snowflake(payload.author.id);
    const message = {
        // UNTRANSFORMED STUFF HERE
        content: payload.content || "",
        isBot: payload.author.bot || false,
        tag: `${payload.author.username}#${payload.author.discriminator}`,
        timestamp: Date.parse(payload.timestamp),
        editedTimestamp: payload.edited_timestamp ? Date.parse(payload.edited_timestamp) : undefined,
        bitfield: (payload.tts ? 1n : 0n) | (payload.mention_everyone ? 2n : 0n) | (payload.pinned ? 4n : 0n),
        attachments: payload.attachments?.map((attachment)=>bot.transformers.attachment(bot, attachment)
        ),
        embeds: payload.embeds?.map((embed)=>bot.transformers.embed(bot, embed)
        ),
        reactions: payload.reactions?.map((reaction)=>({
                me: reaction.me,
                count: reaction.count,
                emoji: bot.transformers.emoji(bot, reaction.emoji)
            })
        ),
        type: payload.type,
        activity: payload.activity ? {
            type: payload.activity.type,
            partyId: payload.activity.party_id
        } : undefined,
        application: payload.application,
        flags: payload.flags,
        interaction: payload.interaction ? {
            id: bot.transformers.snowflake(payload.interaction.id),
            type: payload.interaction.type,
            name: payload.interaction.name,
            user: bot.transformers.user(bot, payload.interaction.user),
            member: payload.interaction.member ? {
                id: userId,
                guildId,
                nick: payload.interaction.member.nick ?? undefined,
                roles: payload.interaction.member.roles?.map((id)=>bot.transformers.snowflake(id)
                ),
                joinedAt: payload.interaction.member.joined_at ? Date.parse(payload.interaction.member.joined_at) : undefined,
                premiumSince: payload.interaction.member.premium_since ? Date.parse(payload.interaction.member.premium_since) : undefined,
                toggles: new MemberToggles(payload.interaction.member),
                avatar: payload.interaction.member.avatar ? bot.utils.iconHashToBigInt(payload.interaction.member.avatar) : undefined,
                permissions: payload.interaction.member.permissions ? bot.transformers.snowflake(payload.interaction.member.permissions) : undefined,
                communicationDisabledUntil: payload.interaction.member.communication_disabled_until ? Date.parse(payload.interaction.member.communication_disabled_until) : undefined
            } : undefined
        } : undefined,
        thread: payload.thread ? bot.transformers.channel(bot, {
            channel: payload.thread,
            guildId
        }) : undefined,
        components: payload.components?.map((component)=>bot.transformers.component(bot, component)
        ),
        stickerItems: payload.sticker_items?.map((sticker)=>({
                id: bot.transformers.snowflake(sticker.id),
                name: sticker.name,
                formatType: sticker.format_type
            })
        ),
        // TRANSFORMED STUFF BELOW
        id: bot.transformers.snowflake(payload.id),
        guildId,
        channelId: bot.transformers.snowflake(payload.channel_id),
        webhookId: payload.webhook_id ? bot.transformers.snowflake(payload.webhook_id) : undefined,
        authorId: userId,
        applicationId: payload.application_id ? bot.transformers.snowflake(payload.application_id) : undefined,
        messageReference: payload.message_reference ? {
            messageId: payload.message_reference.message_id ? bot.transformers.snowflake(payload.message_reference.message_id) : undefined,
            channelId: payload.message_reference.channel_id ? bot.transformers.snowflake(payload.message_reference.channel_id) : undefined,
            guildId: payload.message_reference.guild_id ? bot.transformers.snowflake(payload.message_reference.guild_id) : undefined
        } : undefined,
        mentionedUserIds: payload.mentions ? payload.mentions.map((m)=>bot.transformers.snowflake(m.id)
        ) : [],
        mentionedRoleIds: payload.mention_roles ? payload.mention_roles.map((id)=>bot.transformers.snowflake(id)
        ) : [],
        mentionedChannelIds: [
            // Keep any ids tht discord sends
            ...(payload.mention_channels ?? []).map((m)=>bot.transformers.snowflake(m.id)
            ),
            // Add any other ids that can be validated in a channel mention format
            ...(payload.content?.match(CHANNEL_MENTION_REGEX) || []).map((text)=>// converts the <#123> into 123
                bot.transformers.snowflake(text.substring(2, text.length - 1))
            ), 
        ],
        member: payload.member && guildId ? bot.transformers.member(bot, payload.member, guildId, userId) : undefined
    };
    return message;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBCb3QgfSBmcm9tIFwiLi4vYm90LnRzXCI7XG5pbXBvcnQgeyBEaXNjb3JkTWVzc2FnZSB9IGZyb20gXCIuLi90eXBlcy9kaXNjb3JkLnRzXCI7XG5pbXBvcnQgeyBDSEFOTkVMX01FTlRJT05fUkVHRVggfSBmcm9tIFwiLi4vdXRpbC9jb25zdGFudHMudHNcIjtcbmltcG9ydCB7IE1lbWJlclRvZ2dsZXMgfSBmcm9tIFwiLi90b2dnbGVzL21lbWJlci50c1wiO1xuaW1wb3J0IHsgT3B0aW9uYWxpemUgfSBmcm9tIFwiLi4vdHlwZXMvc2hhcmVkLnRzXCI7XG5cbmV4cG9ydCBmdW5jdGlvbiB0cmFuc2Zvcm1NZXNzYWdlKGJvdDogQm90LCBwYXlsb2FkOiBEaXNjb3JkTWVzc2FnZSkge1xuICBjb25zdCBndWlsZElkID0gcGF5bG9hZC5ndWlsZF9pZCA/IGJvdC50cmFuc2Zvcm1lcnMuc25vd2ZsYWtlKHBheWxvYWQuZ3VpbGRfaWQpIDogdW5kZWZpbmVkO1xuICBjb25zdCB1c2VySWQgPSBib3QudHJhbnNmb3JtZXJzLnNub3dmbGFrZShwYXlsb2FkLmF1dGhvci5pZCk7XG5cbiAgY29uc3QgbWVzc2FnZSA9IHtcbiAgICAvLyBVTlRSQU5TRk9STUVEIFNUVUZGIEhFUkVcbiAgICBjb250ZW50OiBwYXlsb2FkLmNvbnRlbnQgfHwgXCJcIixcbiAgICBpc0JvdDogcGF5bG9hZC5hdXRob3IuYm90IHx8IGZhbHNlLFxuICAgIHRhZzogYCR7cGF5bG9hZC5hdXRob3IudXNlcm5hbWV9IyR7cGF5bG9hZC5hdXRob3IuZGlzY3JpbWluYXRvcn1gLFxuICAgIHRpbWVzdGFtcDogRGF0ZS5wYXJzZShwYXlsb2FkLnRpbWVzdGFtcCksXG4gICAgZWRpdGVkVGltZXN0YW1wOiBwYXlsb2FkLmVkaXRlZF90aW1lc3RhbXAgPyBEYXRlLnBhcnNlKHBheWxvYWQuZWRpdGVkX3RpbWVzdGFtcCkgOiB1bmRlZmluZWQsXG4gICAgYml0ZmllbGQ6IChwYXlsb2FkLnR0cyA/IDFuIDogMG4pIHwgKHBheWxvYWQubWVudGlvbl9ldmVyeW9uZSA/IDJuIDogMG4pIHwgKHBheWxvYWQucGlubmVkID8gNG4gOiAwbiksXG4gICAgYXR0YWNobWVudHM6IHBheWxvYWQuYXR0YWNobWVudHM/Lm1hcCgoYXR0YWNobWVudCkgPT4gYm90LnRyYW5zZm9ybWVycy5hdHRhY2htZW50KGJvdCwgYXR0YWNobWVudCkpLFxuICAgIGVtYmVkczogcGF5bG9hZC5lbWJlZHM/Lm1hcCgoZW1iZWQpID0+IGJvdC50cmFuc2Zvcm1lcnMuZW1iZWQoYm90LCBlbWJlZCkpLFxuICAgIHJlYWN0aW9uczogcGF5bG9hZC5yZWFjdGlvbnM/Lm1hcCgocmVhY3Rpb24pID0+ICh7XG4gICAgICBtZTogcmVhY3Rpb24ubWUsXG4gICAgICBjb3VudDogcmVhY3Rpb24uY291bnQsXG4gICAgICBlbW9qaTogYm90LnRyYW5zZm9ybWVycy5lbW9qaShib3QsIHJlYWN0aW9uLmVtb2ppKSxcbiAgICB9KSksXG4gICAgdHlwZTogcGF5bG9hZC50eXBlLFxuICAgIGFjdGl2aXR5OiBwYXlsb2FkLmFjdGl2aXR5XG4gICAgICA/IHtcbiAgICAgICAgdHlwZTogcGF5bG9hZC5hY3Rpdml0eS50eXBlLFxuICAgICAgICBwYXJ0eUlkOiBwYXlsb2FkLmFjdGl2aXR5LnBhcnR5X2lkLFxuICAgICAgfVxuICAgICAgOiB1bmRlZmluZWQsXG4gICAgYXBwbGljYXRpb246IHBheWxvYWQuYXBwbGljYXRpb24sXG4gICAgZmxhZ3M6IHBheWxvYWQuZmxhZ3MsXG4gICAgaW50ZXJhY3Rpb246IHBheWxvYWQuaW50ZXJhY3Rpb25cbiAgICAgID8ge1xuICAgICAgICBpZDogYm90LnRyYW5zZm9ybWVycy5zbm93Zmxha2UocGF5bG9hZC5pbnRlcmFjdGlvbi5pZCksXG4gICAgICAgIHR5cGU6IHBheWxvYWQuaW50ZXJhY3Rpb24udHlwZSxcbiAgICAgICAgbmFtZTogcGF5bG9hZC5pbnRlcmFjdGlvbi5uYW1lLFxuICAgICAgICB1c2VyOiBib3QudHJhbnNmb3JtZXJzLnVzZXIoYm90LCBwYXlsb2FkLmludGVyYWN0aW9uLnVzZXIpLFxuICAgICAgICBtZW1iZXI6IHBheWxvYWQuaW50ZXJhY3Rpb24ubWVtYmVyXG4gICAgICAgICAgPyB7XG4gICAgICAgICAgICBpZDogdXNlcklkLFxuICAgICAgICAgICAgZ3VpbGRJZCxcbiAgICAgICAgICAgIG5pY2s6IHBheWxvYWQuaW50ZXJhY3Rpb24ubWVtYmVyLm5pY2sgPz8gdW5kZWZpbmVkLFxuICAgICAgICAgICAgcm9sZXM6IHBheWxvYWQuaW50ZXJhY3Rpb24ubWVtYmVyLnJvbGVzPy5tYXAoKGlkKSA9PiBib3QudHJhbnNmb3JtZXJzLnNub3dmbGFrZShpZCkpLFxuICAgICAgICAgICAgam9pbmVkQXQ6IHBheWxvYWQuaW50ZXJhY3Rpb24ubWVtYmVyLmpvaW5lZF9hdFxuICAgICAgICAgICAgICA/IERhdGUucGFyc2UocGF5bG9hZC5pbnRlcmFjdGlvbi5tZW1iZXIuam9pbmVkX2F0KVxuICAgICAgICAgICAgICA6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIHByZW1pdW1TaW5jZTogcGF5bG9hZC5pbnRlcmFjdGlvbi5tZW1iZXIucHJlbWl1bV9zaW5jZVxuICAgICAgICAgICAgICA/IERhdGUucGFyc2UocGF5bG9hZC5pbnRlcmFjdGlvbi5tZW1iZXIucHJlbWl1bV9zaW5jZSlcbiAgICAgICAgICAgICAgOiB1bmRlZmluZWQsXG4gICAgICAgICAgICB0b2dnbGVzOiBuZXcgTWVtYmVyVG9nZ2xlcyhwYXlsb2FkLmludGVyYWN0aW9uLm1lbWJlciksXG4gICAgICAgICAgICBhdmF0YXI6IHBheWxvYWQuaW50ZXJhY3Rpb24ubWVtYmVyLmF2YXRhclxuICAgICAgICAgICAgICA/IGJvdC51dGlscy5pY29uSGFzaFRvQmlnSW50KHBheWxvYWQuaW50ZXJhY3Rpb24ubWVtYmVyLmF2YXRhcilcbiAgICAgICAgICAgICAgOiB1bmRlZmluZWQsXG4gICAgICAgICAgICBwZXJtaXNzaW9uczogcGF5bG9hZC5pbnRlcmFjdGlvbi5tZW1iZXIucGVybWlzc2lvbnNcbiAgICAgICAgICAgICAgPyBib3QudHJhbnNmb3JtZXJzLnNub3dmbGFrZShwYXlsb2FkLmludGVyYWN0aW9uLm1lbWJlci5wZXJtaXNzaW9ucylcbiAgICAgICAgICAgICAgOiB1bmRlZmluZWQsXG4gICAgICAgICAgICBjb21tdW5pY2F0aW9uRGlzYWJsZWRVbnRpbDogcGF5bG9hZC5pbnRlcmFjdGlvbi5tZW1iZXIuY29tbXVuaWNhdGlvbl9kaXNhYmxlZF91bnRpbFxuICAgICAgICAgICAgICA/IERhdGUucGFyc2UocGF5bG9hZC5pbnRlcmFjdGlvbi5tZW1iZXIuY29tbXVuaWNhdGlvbl9kaXNhYmxlZF91bnRpbClcbiAgICAgICAgICAgICAgOiB1bmRlZmluZWQsXG4gICAgICAgICAgfVxuICAgICAgICAgIDogdW5kZWZpbmVkLFxuICAgICAgfVxuICAgICAgOiB1bmRlZmluZWQsXG4gICAgdGhyZWFkOiBwYXlsb2FkLnRocmVhZCA/IGJvdC50cmFuc2Zvcm1lcnMuY2hhbm5lbChib3QsIHsgY2hhbm5lbDogcGF5bG9hZC50aHJlYWQsIGd1aWxkSWQgfSkgOiB1bmRlZmluZWQsXG4gICAgY29tcG9uZW50czogcGF5bG9hZC5jb21wb25lbnRzPy5tYXAoKGNvbXBvbmVudCkgPT4gYm90LnRyYW5zZm9ybWVycy5jb21wb25lbnQoYm90LCBjb21wb25lbnQpKSxcbiAgICBzdGlja2VySXRlbXM6IHBheWxvYWQuc3RpY2tlcl9pdGVtcz8ubWFwKChzdGlja2VyKSA9PiAoe1xuICAgICAgaWQ6IGJvdC50cmFuc2Zvcm1lcnMuc25vd2ZsYWtlKHN0aWNrZXIuaWQpLFxuICAgICAgbmFtZTogc3RpY2tlci5uYW1lLFxuICAgICAgZm9ybWF0VHlwZTogc3RpY2tlci5mb3JtYXRfdHlwZSxcbiAgICB9KSksXG5cbiAgICAvLyBUUkFOU0ZPUk1FRCBTVFVGRiBCRUxPV1xuICAgIGlkOiBib3QudHJhbnNmb3JtZXJzLnNub3dmbGFrZShwYXlsb2FkLmlkKSxcbiAgICBndWlsZElkLFxuICAgIGNoYW5uZWxJZDogYm90LnRyYW5zZm9ybWVycy5zbm93Zmxha2UocGF5bG9hZC5jaGFubmVsX2lkKSxcbiAgICB3ZWJob29rSWQ6IHBheWxvYWQud2ViaG9va19pZCA/IGJvdC50cmFuc2Zvcm1lcnMuc25vd2ZsYWtlKHBheWxvYWQud2ViaG9va19pZCkgOiB1bmRlZmluZWQsXG4gICAgYXV0aG9ySWQ6IHVzZXJJZCxcbiAgICBhcHBsaWNhdGlvbklkOiBwYXlsb2FkLmFwcGxpY2F0aW9uX2lkID8gYm90LnRyYW5zZm9ybWVycy5zbm93Zmxha2UocGF5bG9hZC5hcHBsaWNhdGlvbl9pZCkgOiB1bmRlZmluZWQsXG4gICAgbWVzc2FnZVJlZmVyZW5jZTogcGF5bG9hZC5tZXNzYWdlX3JlZmVyZW5jZVxuICAgICAgPyB7XG4gICAgICAgIG1lc3NhZ2VJZDogcGF5bG9hZC5tZXNzYWdlX3JlZmVyZW5jZS5tZXNzYWdlX2lkXG4gICAgICAgICAgPyBib3QudHJhbnNmb3JtZXJzLnNub3dmbGFrZShwYXlsb2FkLm1lc3NhZ2VfcmVmZXJlbmNlLm1lc3NhZ2VfaWQpXG4gICAgICAgICAgOiB1bmRlZmluZWQsXG4gICAgICAgIGNoYW5uZWxJZDogcGF5bG9hZC5tZXNzYWdlX3JlZmVyZW5jZS5jaGFubmVsX2lkXG4gICAgICAgICAgPyBib3QudHJhbnNmb3JtZXJzLnNub3dmbGFrZShwYXlsb2FkLm1lc3NhZ2VfcmVmZXJlbmNlLmNoYW5uZWxfaWQpXG4gICAgICAgICAgOiB1bmRlZmluZWQsXG4gICAgICAgIGd1aWxkSWQ6IHBheWxvYWQubWVzc2FnZV9yZWZlcmVuY2UuZ3VpbGRfaWRcbiAgICAgICAgICA/IGJvdC50cmFuc2Zvcm1lcnMuc25vd2ZsYWtlKHBheWxvYWQubWVzc2FnZV9yZWZlcmVuY2UuZ3VpbGRfaWQpXG4gICAgICAgICAgOiB1bmRlZmluZWQsXG4gICAgICB9XG4gICAgICA6IHVuZGVmaW5lZCxcbiAgICBtZW50aW9uZWRVc2VySWRzOiBwYXlsb2FkLm1lbnRpb25zID8gcGF5bG9hZC5tZW50aW9ucy5tYXAoKG0pID0+IGJvdC50cmFuc2Zvcm1lcnMuc25vd2ZsYWtlKG0uaWQpKSA6IFtdLFxuICAgIG1lbnRpb25lZFJvbGVJZHM6IHBheWxvYWQubWVudGlvbl9yb2xlcyA/IHBheWxvYWQubWVudGlvbl9yb2xlcy5tYXAoKGlkKSA9PiBib3QudHJhbnNmb3JtZXJzLnNub3dmbGFrZShpZCkpIDogW10sXG4gICAgbWVudGlvbmVkQ2hhbm5lbElkczogW1xuICAgICAgLy8gS2VlcCBhbnkgaWRzIHRodCBkaXNjb3JkIHNlbmRzXG4gICAgICAuLi4ocGF5bG9hZC5tZW50aW9uX2NoYW5uZWxzID8/IFtdKS5tYXAoKG0pID0+IGJvdC50cmFuc2Zvcm1lcnMuc25vd2ZsYWtlKG0uaWQpKSxcbiAgICAgIC8vIEFkZCBhbnkgb3RoZXIgaWRzIHRoYXQgY2FuIGJlIHZhbGlkYXRlZCBpbiBhIGNoYW5uZWwgbWVudGlvbiBmb3JtYXRcbiAgICAgIC4uLihwYXlsb2FkLmNvbnRlbnQ/Lm1hdGNoKENIQU5ORUxfTUVOVElPTl9SRUdFWCkgfHwgW10pLm1hcCgodGV4dCkgPT5cbiAgICAgICAgLy8gY29udmVydHMgdGhlIDwjMTIzPiBpbnRvIDEyM1xuICAgICAgICBib3QudHJhbnNmb3JtZXJzLnNub3dmbGFrZSh0ZXh0LnN1YnN0cmluZygyLCB0ZXh0Lmxlbmd0aCAtIDEpKVxuICAgICAgKSxcbiAgICBdLFxuICAgIG1lbWJlcjogcGF5bG9hZC5tZW1iZXIgJiYgZ3VpbGRJZCA/IGJvdC50cmFuc2Zvcm1lcnMubWVtYmVyKGJvdCwgcGF5bG9hZC5tZW1iZXIsIGd1aWxkSWQsIHVzZXJJZCkgOiB1bmRlZmluZWQsXG4gIH07XG5cbiAgcmV0dXJuIG1lc3NhZ2UgYXMgT3B0aW9uYWxpemU8dHlwZW9mIG1lc3NhZ2U+O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIE1lc3NhZ2UgZXh0ZW5kcyBS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